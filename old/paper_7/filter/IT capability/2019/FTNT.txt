item 7. management's discussion and analysis of financial condition and results of operations in addition to historical information, this annual report on form 10-k contains forward-looking statements within the meaning of section 27a of the securities act and section 21e of the exchange act. these statements include, among other things, statements concerning our expectations regarding:
•   variability in sales in certain product categories from year to year and between quarters;
•   the impact of macro-economic, geopolitical factors and other disruption on our manufacturing or sales, including the impact of the coronavirus and other public health issues and natural disasters;
•   drivers of long-term growth and operating leverage, such as increased sales productivity, functionality and value in our standalone and bundled subscription service offerings;
•   growing our sales to businesses, service providers and government organizations, our ability to execute these sales and of the complexity of selling to all segments (including the increased competition and unpredictability of timing associated with sales to larger enterprises), the impact of sales to these organizations on our long-term growth, expansion and operating results, and the effectiveness of our internal sales organization;
•   our ability to hire properly qualified and effective sales, support and engineering employees;
•   risks and expectations related to acquisitions or sales of assets, including integration issues related to product plans and products, including the acquired technology;
•   expectations that proceeds from the exercise of stock options in future years will be adversely impacted by the increased mix of restricted stock units versus stock options granted;
•   expectations regarding uncertain tax benefits and our effective domestic and global tax rates, and the impact of the tax cuts and jobs act (the "2017 tax act") and the ninth circuit's altera decision regarding stock-based compensation in cost sharing arrangements;
•   expectations regarding spending related to real estate and other capital expenditures and to the impact on free cash flows;
•   competition in our markets;
•   statements regarding expected outcomes and liabilities in litigation;
•   other statements regarding our future operations, financial condition and prospects and business strategies; and
these forward-looking statements are subject to certain risks and uncertainties that could cause our actual results to differ materially from those reflected in the forward-looking statements. factors that could cause or contribute to such differences include, but are not limited to, those discussed in this annual report on form 10-k and, in particular, the risks discussed under the heading "risk factors" in part i, item 1a of this annual report on form 10-k and those discussed in other documents we file with the securities and exchange commission (the "sec"). we undertake no obligation, and specifically disclaim any obligation, to revise or publicly release the results of any revision to these and any other forward-looking statements. given these risks and uncertainties, readers are cautioned not to place undue reliance on such forward-looking statements.
business overview fortinet is a global leader in cybersecurity solutions provided to a wide variety of organizations, such as enterprises, communication service providers, government organizations and small businesses. our cybersecurity solutions are designed to provide broad visibility and segmentation of the digital attack surface through our integrated fortinet security fabric platform, which features automated protection, detection and response.
•   network security-we derive a majority of product sales from our fortigate network security appliances. our fortigate network security appliances include a broad set of built-in security and networking features and functionalities, including firewall, next-generation firewall, secure web gateway, ssl inspection, sd-wan, intrusion prevention, ssl data leak prevention, vpn, switch and wireless controller and wide area network edge. our network security appliances are managed by our fortios network operating system, which provides the foundation for fortigate security functions. we enhance the performance of our network security appliances from branch to data center by designing and implementing spu technology within our appliances, enabling us to add security and network functionality with minimal impact to network throughput performance.
•   infrastructure security-the fortinet security fabric platform is a broad, automated and integrated security platform that extends beyond the network to cover other attack vectors. other infrastructure solutions covered include secure access (wi-fi and switch).
•   cloud security-we help customers connect securely to and across their hybrid, public and private cloud environments by offering security through our virtual firewall and other software products in public and private cloud environments. our cloud security solutions, including virtual appliances and hosted solutions, extend the core capabilities of the fortinet security fabric platform to provide businesses with the same level of cybersecurity and threat intelligence in and across cloud environments that they receive on their physical networks. fortinet cloud security offerings are available across all major cloud providers, including amazon web services, microsoft azure, google cloud, oracle cloud, alibaba cloud and ibm cloud. our cloud security portfolio also includes securing applications, including email and web.
•   endpoint protection, internet of things and operational technology security-we protect end-customers from advanced threats that target their devices and the data that reside on them through our advanced endpoint solutions that provide core endpoint protection, advanced threat protection, incident monitoring, and response. additionally, the proliferation of iot and the digitization of ot devices has generated new opportunities for us to grow our business. we offer network access control solutions that provide visibility, control and automated event responses in order to secure iot devices.
we also develop and provide ai-driven security operations solutions, including fortiguard security services that can be applied across the entire fortinet security fabric platform. these solutions help customers better secure their environments by delivering deeper intelligence and insights and by narrowing the gaps in security skills and resources that are present in many organizations.
in addition to our security solutions, our customers, channel partners and end-customers may purchase fortiguard and other security subscription services to receive threat intelligence updates, forticare technical support services across all of our products and the support of technical account managers, resident engineers and professional service consultants for implementations or training services.
•   we generated cash flows from operating activities of $808.0 million in 2019, an increase of $169.1 million, or 26%, compared to 2018.
our revenue growth was driven by both product and service revenue. on a geographic basis, revenue continues to be diversified globally, which remains a key strength of our business. product revenue grew 17% in 2019. we experienced revenue growth across several of our hardware and software products, including fortigate enabled with sd-wan features. service revenue growth of 21% in 2019 was driven by the strength of our fortiguard and other security subscription revenue, which grew 24%.
during the second quarter of 2019, we reclassified the 100 series of our fortigate product from an entry-level product to a mid-range product. prior periods have been reclassified to conform with current period presentation. including this reclassification, we saw a mix shift from high-end to mid-range products in 2019.
during the fourth quarter of 2019, we acquired ensilo limited ("ensilo") and cybersponse inc. ("cybersponse") to further strengthen our fortinet security fabric platform by providing real-time automated endpoint detection and response capability (ensilo) and security orchestration, automation and response products and services (cybersponse). the impact of these acquisitions, individually and in the aggregate, were not material to our consolidated financial statements.
in 2019, our revenue growth outpaced our growth in operating expenses. as a result, operating expenses as a percentage of revenue decreased by two percentage points compared to 2018. headcount increased by 21% to 7,082 employees and contractors as of december 31, 2019, up from 5,845 as of december 31, 2018. the acquisition of ensilo and cybersponse increased headcount by 135 employees. excluding these two acquisitions, headcount would have increased 19% year over year.
the impact of the coronavirus outbreak on our business remains uncertain, and, though the majority of our products are manufactured outside of china, certain components for our products and certain of our products are manufactured in china and taiwan and we have international shipping and logistics centers in taiwan. while any significant impact is uncertain at this point, if the coronavirus outbreak continues to spread, the business disruption caused thereby could have a material negative impact on our billings, revenue, gross margin, operating margin, cash flows and other financial results for the first quarter of 2020 and certain periods thereafter.
business model we primarily sell our products and services through a two-tier distribution model. we sell to distributors that sell to networking security and enterprise-focused resellers and to service providers and mssps, who, in turn, sell to our end-customers. in certain cases, we sell directly to large service providers and major systems integrators. in certain cases, we sell directly to large service providers and major systems integrators. we also offer our products across major cloud providers, and have recognized on-demand revenue from amazon web services, microsoft azure, ibm cloud, google cloud and oracle cloud. we have also recognized revenue from customers who deploy our products in a bring-your-own-license ("byol") arrangement at a cloud provider such as amazon web services, microsoft azure, google cloud, oracle cloud and alibaba cloud. in a byol arrangement, a customer purchases a software license from us through our channel partners and deploys the software in a cloud provider's environment. similarly, customers may purchase such a license from us and deploy in their private cloud.
typically, our customers purchase our hardware products and software licenses, as well as our fortiguard security subscription and forticare technical support services. we generally invoice at the time of our sale for the total price of the products and security and technical support services. the invoice is typically payable within 30 to 45 days. we also invoice certain services on a monthly basis.
key metrics we monitor a number of key metrics, including the key financial metrics set forth below, in order to help us evaluate growth trends, establish budgets, measure the effectiveness of our sales and marketing efforts, and assess operational efficiencies. the following table summarizes revenue, deferred revenue, billings (non-gaap), net cash provided by operating activities, and free cash flow (non-gaap). we discuss revenue below under "-components of operating results," and we discuss net cash provided by operating activities below under "-liquidity and capital resources." deferred revenue, billings (non-gaap), and free cash flow (non-gaap) are discussed immediately below the following table.
net cash provided by operating activities        $808.0                  $638.9                  $594.4
deferred revenue. our deferred revenue consists of amounts that have been invoiced but that have not yet been recognized as revenue. the majority of our deferred revenue balance consists of the unrecognized portion of service revenue from fortiguard security subscription and forticare technical support service contracts, which is recognized as revenue ratably over the contractual service period. we monitor our deferred revenue balance, deferred revenue growth and the mix of short-term and long-term deferred revenue because deferred revenue represents a significant portion of free cash flow and of revenue to be recognized in future periods. deferred revenue was $2.14 billion as of december 31, 2019, an increase of $449.1 million, or 27%, from december 31, 2018.
billings (non-gaap). we define billings as revenue recognized in accordance with generally accepted accounting principles in the united states ("gaap") plus the change in deferred revenue from the beginning to the end of the period and adjustments to the deferred revenue balance due to adoption of financial accounting standards board ("fasb") topic 606, revenue from contracts with customers ("topic 606"), less any deferred revenue balances acquired from business combination(s) during the period. we consider billings to be a useful metric for management and investors because billings
drive current and future revenue, which is an important indicator of the health and viability of our business. there are a number of limitations related to the use of billings instead of gaap revenue. first, billings include amounts that have not yet been recognized as revenue and are impacted by the security and support contractual service period agreements. second, we may calculate billings in a manner that is different from peer companies that report similar financial measures. management accounts for these limitations by providing specific information regarding gaap revenue and evaluating billings together with gaap revenue. total billings were $2.60 billion for 2019, an increase of 21% compared to $2.15 billion in 2018.
a reconciliation of revenue, the most directly comparable financial measure calculated and presented in accordance with gaap, to billings is provided below:
free cash flow (non-gaap). we define free cash flow as net cash provided by operating activities minus purchases of property and equipment. we believe free cash flow to be a liquidity measure that provides useful information to management and investors about the amount of cash generated by the business that, after capital expenditures, can be used for strategic opportunities, including repurchasing outstanding common stock, investing in our business, making strategic acquisitions and strengthening the balance sheet. a limitation of using free cash flow rather than the gaap measures of cash provided by or used in operating activities, investing activities, and financing activities is that free cash flow does not represent the total increase or decrease in the cash and cash equivalents balance for the period because it excludes cash flows from investing activities other than capital expenditures and cash flows from financing activities. management accounts for this limitation by providing information about our capital expenditures and other investing and financing activities on the face of the consolidated statements of cash flows and under "-liquidity and capital resources" and by presenting cash flows from investing and financing activities in our reconciliation of free cash flow. in addition, it is important to note that other companies, including companies in our industry, may not use free cash flow, may calculate free cash flow in a different manner than we do or may use other financial measures to evaluate their performance, all of which could reduce the usefulness of free cash flow as a comparative measure. a reconciliation of net cash provided by operating activities, the most directly comparable financial measure calculated and presented in accordance with gaap, to free cash flow is provided below:
net cash provided by operating activities   $808.0                $638.9                $594.4
net cash used in investing activities       $(502.3     )         $(134.9     )         $(76.8      )
net cash used in financing activities       $(195.6     )         $(202.6     )         $(415.6     )
components of operating results revenue. we generate the majority of our revenue from sales of our hardware and software products and amortization of amounts included in deferred revenue related to previous sales of fortiguard security subscription and forticare technical support services. we also recognize revenue from cloud security solutions, professional services and training.
•   product revenue. product revenue is primarily generated from sales of our appliances. the majority of our product revenue has been generated by our fortigate product line, and we do not expect this to change in the foreseeable future. product revenue also includes revenue derived from sales of fabric hardware and software products, including fortigate software licenses. as a percentage of total revenue, we expect that our product revenue may vary from quarter-to-quarter based on certain factors, as discussed below under "-quarterly results of operations," and we expect the trend to continue in 2020.
•   service revenue. service revenue is generated primarily from fortiguard security subscription services and forticare technical support services. we recognize revenue from fortiguard security subscription and forticare technical support services over the contractual service period. our typical contractual support and subscription term is one to three years and, to a lesser extent, five years. we also generate a small portion of our revenue from professional services and training services, for which we recognize revenue as the services are provided, and cloud-based services, for which we recognize revenue as the services are delivered or on a monthly usage basis. as a percentage of total revenue, we continue to expect service revenue to be higher than product revenue. our service revenue growth rate depends significantly on the growth of our customer base, the expansion of our service bundle offerings, the expansion and introduction of new service offerings and the renewal of service contracts by our existing customers.
•   cost of product revenue. the majority of the cost of product revenue consists of third-party contract manufacturers' costs and the costs of materials used in production. our cost of product revenue also includes supplies, shipping costs, personnel costs associated with logistics and quality control, facility-related costs, excess and obsolete inventory costs, warranty costs and amortization of intangible assets. personnel costs include direct compensation and benefits.
•   cost of service revenue. cost of service revenue is primarily comprised of salaries, benefits and bonuses, as well as stock-based compensation. cost of service revenue also includes third-party repair and contract fulfillment, data center and cloud hosting, supplies and facility-related costs.
gross margin. gross profit as a percentage of revenue, or gross margin, has been and will continue to be affected by a variety of factors, including the average sales price of our products, product costs, the mix of products sold and the mix of revenue between hardware products, software licenses and services and any excess inventory write-offs. service revenue and software licenses have had a positive effect on our total gross margin given the higher gross margins compared to hardware product gross margins. during 2019, service gross margin benefited from renewals and continued sales of services and subscriptions, growing faster than related expenses. product gross margin benefited from gains in average selling price, as well as lower direct and indirect product costs as a percentage of product revenue. it also benefited from deal mix, software revenue growth and a stable product transition environment. cost of product revenue was comprised of direct product costs and indirect costs, including inventory reserves and other manufacturing overhead. overall gross margin in 2020 will be impacted by service and product revenue mix, but we expect it to be comparable to overall gross margin in 2019.
operating expenses. our operating expenses consist of research and development, sales and marketing and general and administrative expenses. personnel costs are the most significant component of operating expenses and consist primarily of salaries, benefits, bonuses, stock-based compensation, and sales commissions, as applicable. we expect personnel costs to continue to increase in absolute dollars as we expand our workforce.
•   research and development. research and development expense consists primarily of personnel costs. additional research and development expenses include asic and system prototypes and certification-related expenses, depreciation of property and equipment and facility-related expenses. the majority of our research and development is focused on both software development and the ongoing development of our hardware platform. we record all research and development expenses as incurred. our research and development teams are primarily located in canada and the united states.
•   sales and marketing. sales and marketing expense is the largest component of our operating expenses and primarily consists of personnel costs. additional sales and marketing expenses include product marketing, public relations, field marketing and channel marketing programs (e.g. partner cooperative marketing arrangements), as well as travel, depreciation of property and equipment and facility-related expenses. we
intend to hire additional personnel focused on sales and marketing and expand our sales and marketing efforts worldwide in order to capture market share in the enterprise market.
•   general and administrative. general and administrative expense consists of personnel costs, as well as professional fees, depreciation of property and equipment and software and facility-related expenses. general and administrative personnel include our executive, finance, human resources, information technology and legal organizations. our professional fees principally consist of outside legal, auditing, accounting, tax, information technology and other consulting costs.
interest income-net. interest income-net consists of interest earned on our cash, cash equivalents and investments. we have historically invested our cash in corporate debt securities, certificates of deposit and term deposits, commercial paper, money market funds, and u.s. government and agency securities.
provision for (benefit from) income taxes. we are subject to income taxes in the united states, as well as other tax jurisdictions or countries in which we conduct business. earnings from our non-u.s. activities are subject to income taxes in local countries and may be subject to u.s. income taxes. our effective tax rate differs from the u.s. statutory rate primarily due to foreign income subject to different tax rates than in the u.s., nondeductible stock-based compensation expense, federal research and development tax credit, state taxes, withholding taxes, excess tax benefits related to stock-based compensation expense and the tax impacts of the 2017 tax act.
critical accounting policies and estimates our discussion and analysis of our financial condition and results of operations are based upon our financial statements, which have been prepared in accordance with gaap. these principles require us to make estimates and judgments that affect the reported amounts of assets, liabilities, revenue, cost of revenue and expenses, and related disclosures. we base our estimates on historical experience and on various other assumptions that we believe to be reasonable under the circumstances. to the extent that there are material differences between these estimates and our actual results, our future financial statements will be affected.
we believe that, of the significant accounting policies described in note 1 to our consolidated financial statements included in part ii, item 8 of this annual report on form 10-k, the following accounting policies involve a greater degree of judgment and complexity. accordingly, we believe these are the most critical to fully understand and evaluate our financial condition and results of operations.
revenue recognition on january 1, 2018, we adopted topic 606, revenue from contracts with customers, using the modified retrospective method applied to those contracts which were not completed as of january 1, 2018. results for reporting periods beginning after january 1, 2018 are presented under topic 606, while prior period amounts are not adjusted and continue to be reported under asc topic 605 ("topic 605"), revenue recognition.
beginning in 2018, revenues are recognized when control of goods or services is transferred to our customers, in an amount that reflects the consideration we expect to be entitled to in exchange for those goods or services. prior to 2018, revenue was recognized under topic 605 when all of the following criteria were met: (i) persuasive evidence of an arrangement existed, (ii) delivery has occurred or services have been rendered, (iii) sales price was fixed or determinable and (iv) collectability was reasonably assured.
under topic 606, we determine revenue recognition through the following steps:
•   identification of a contract or contracts with a customer;
•   recognition of revenue when, or as, we satisfy a performance obligation.
our sales contracts typically contain multiple deliverables, such as hardware, software license, security subscription, technical support services and other services, which are generally capable of being distinct and accounted for as separate performance obligations. we evaluated the criteria to be distinct under topic 606 and concluded that the hardware and software licenses were distinct and distinct in the context of a contract from the security subscription and technical support services, as a customer can benefit from the hardware and software licenses without the services and the services are separately identifiable within a contract. we allocate a transaction price to each performance obligation based on relative standalone selling price. if not observable through past transactions, we determine standalone selling price based on the historical pricing and discounting practices for those services when sold separately. we determine standalone selling price for a product or service by considering multiple historical factors including, but not limited to, cost of products, gross margin objectives, pricing practices, geographies and the term of a service contract that fall within a reasonably range as a percentage of list price.
under the previous standard, topic 605, revenue from contracts that contain products and services is allocated to each unit of accounting based on an estimated selling price using vendor-specific objective evidence ("vsoe") of selling price, if it existed, or third-party evidence ("tpe") of selling price. if neither vsoe nor tpe of selling price existed for a deliverable, we used our best estimate of selling price for that deliverable. for multiple-element arrangements where software deliverables were included, revenue was allocated to the non-software deliverables and to the software deliverables as a group using the relative estimated selling prices of each of the deliverables in an arrangement based on the estimated selling price hierarchy. the amount allocated to the software deliverables was then allocated to each software deliverable using the residual method when vsoe of fair value existed. if evidence of vsoe of fair value of one or more undelivered elements did not exist, all software allocated revenue was deferred and recognized when delivery of those elements occurred or when fair value was established. when the undelivered element for which we did not have vsoe of fair value was support, revenue for the entire arrangement was recognized ratably over the support period. the same residual method and vsoe of fair value principles applied for our multiple element arrangements that contained only software elements.
deferred contract costs and commission expense beginning in 2018, we recognized commission expense based on topic 606's guidance for contract costs. under this new guidance, we recognize sales commissions related to product sales upfront while sales commissions for service contracts are deferred as deferred contract costs in the consolidated balance sheets and amortized over the applicable amortization period. costs for initial contracts that are not commensurate with renewal commissions are amortized on a straight-line basis over the period of benefit, which we have determined to be five years and which is typically longer than the initial contract term. significant estimates, assumptions, and judgments in accounting for deferred contract costs include, but are not limited to, identification of contract costs, anticipated billings and the expected period of benefit.
valuation of inventory inventory is recorded at the lower of cost or net realizable value. cost is computed using the first-in, first-out method. in assessing the ultimate recoverability of inventory, we make estimates regarding future customer demand, the timing of new product introductions, economic trends and market conditions. if the actual product demand is significantly lower than forecasted, we could be required to record inventory write-downs which would be charged to cost of product revenue. any write-downs could have an adverse impact on our gross margins and profitability.
business combinations we include the results of operations of the businesses that we acquire as of the respective dates of acquisition. we allocate the fair value of the purchase price of our business acquisitions to the tangible and intangible assets acquired and liabilities assumed based on their estimated fair values. the excess of the purchase price over the fair values of these identifiable assets and liabilities is recorded as goodwill. we often continue to gather additional information throughout the measurement period, and if we make changes to the amounts recorded, such changes are recorded in the period in which they are identified.
contingent liabilities from time to time, we are involved in disputes, litigation and other legal actions. however, there are many uncertainties associated with any litigation, and these actions or other third-party claims against us may cause us to incur substantial settlement charges, which are inherently difficult to estimate and could adversely affect our results of operations. we review significant new claims and litigation for the probability of an adverse outcome. estimates can change as individual
claims develop. the actual liability in any such matters may be materially different from our estimates, which could result in the need to adjust our liability and record additional expenses.
accounting for income taxes we record income taxes using the asset and liability method, which requires the recognition of deferred tax assets and liabilities for the expected future tax consequences of events that have been recognized in our financial statements or tax returns. in addition, deferred tax assets are recorded for the future benefit of utilizing net operating losses and research and development credit carryforwards. deferred tax assets and liabilities are measured using the currently enacted tax rates that apply to taxable income in effect for the years in which those tax assets and liabilities are expected to be realized or settled. valuation allowances are provided when necessary to reduce deferred tax assets to the amount expected to be realized.
we recognize tax benefits from an uncertain tax position only if it is more likely than not, based on the technical merits of the position that the tax position will be sustained on examination by the tax authorities. the tax benefits recognized in the financial statements from such positions are then measured based on the largest benefit that has a greater than 50% likelihood of being realized upon ultimate settlement.
effective january 1, 2018, the 2017 tax act reduced the federal corporate income tax rate from 35% to 21% and created a territorial tax system with a one-time transition tax on foreign earnings of u.s. subsidiaries not previously subject to u.s. income tax. our selection of an accounting policy for 2018 with respect to the global intangible low-taxed income ("gilti") tax rules was to treat gilti tax as a current period expense under the period cost method. for 2019, we were not subject to gilti. we will continue to monitor and assess the impact of the 2017 tax act and ongoing guidance and accounting interpretations issued in response to the 2017 tax act.
as part of the process of preparing our consolidated financial statements, we are required to estimate our taxes in each of the jurisdictions in which we operate. we estimate actual current tax exposure together with assessing temporary differences resulting from differing treatment of items, such as accruals and allowances not currently deductible for tax purposes. these differences result in deferred tax assets, which are included in our consolidated balance sheets. in general, deferred tax assets represent future tax benefits to be received when certain expenses previously recognized in our consolidated statements of income become deductible expenses under applicable income tax laws, or loss or credit carryforwards are utilized.
in assessing the realizability of deferred tax assets, management considers whether it is more likely than not that some portion or all of the deferred tax assets will be realized. the ultimate realization of deferred tax assets is dependent upon the generation of future taxable income during the periods in which those temporary differences become deductible. we continue to assess the need for a valuation allowance on the deferred tax assets by evaluating both positive and negative evidence that may exist. any adjustment to the valuation allowance on deferred tax assets would be recorded in the consolidated statements of income for the period that the adjustment is determined to be required.
gross profit:
total gross profit                            1,650.3               1,350.8               1,109.6
provision for (benefit from) income taxes        52.7                 (81.3    )             92.6
provision for (benefit from) income taxes     2                (5     )           6
discussion regarding our financial condition and results of operations for 2018 as compared to 2017 can be found in item 7 of our annual report on form 10-k for the fiscal year ended december 31, 2018, filed with the sec on february 27, 2019.
total revenue increased by $355.0 million, or 20%, in 2019 compared to 2018. we continued to experience diversification of revenue globally, and across both customer and industry segments. revenue from all regions grew, with the americas contributing the largest portion of our revenue growth on an absolute dollar basis.
product revenue increased by $114.1 million, or 17%, in 2019 compared to 2018. we experienced revenue growth across many of our hardware and software products due to an increase in product revenue from our sd-wan fortigate solutions and growth in sales of our infrastructure security solutions.
service revenue increased by $240.9 million, or 21%, in 2019 compared to 2018. fortiguard security subscription and forticare technical support and other revenues increased by $144.8 million, or 24%, and by $96.1 million, or 18%, respectively, in 2019 compared to 2018. the increases were primarily due to the recognition of revenue from our growing deferred revenue balance related to fortiguard and other security subscriptions and forticare technical support and other contracts. of the service revenue recognized in 2019, 68% was included in the deferred revenue balance as of december 31, 2018. of the service revenue recognized in 2018, 67% was included in the deferred revenue balance as of december 31, 2017.
total gross margin increased by 1.5 percentage points in 2019 compared to 2018, driven by improvements to both product and service gross margins. product gross margin increased by 1.9 percentage points in 2019 compared to 2018. product gross margin benefited from gains in average selling price, as well as lower direct and indirect product costs as a percentage of product revenue. it also benefited from deal mix, software revenue growth and a stable product transition environment. cost of
sales and marketing sales and marketing expense increased by $144.6 million, or 18%, in 2019 compared to 2018, primarily due to an increase in personnel-related costs of $103.9 million as a result of increases to sales and marketing headcount in order to drive global market share gains. in addition, marketing expenses increased by $16.8 million. we intend to continue to make investments in our sales resources and infrastructure and marketing strategy, which are critical to support growth, and expect sales and marketing expense to increase in absolute dollars in 2020.
general and administrative general and administrative expense increased by $9.1 million, or 10%, in 2019 compared to 2018, primarily due to an increase in personnel-related costs of $6.1 million and an increase in litigation costs of $3.1 million. certain facilities, depreciation, and information technology costs are allocated to other organizations based on headcount. we expect general and administrative expense to increase in absolute dollars in 2020.
operating income and margin we generated operating income of $344.2 million in 2019, an increase of $113.2 million, or 49%, compared to $231.0 million in 2018. operating income as a percentage of revenue increased to 16% in 2019 compared to 13% in 2018. the increase in operating margin is primarily due to the improvement in gross margin by 1.5 percentage points. in addition, as a percent of total revenue, research and development expense decreased by 0.7 percentage points, sales and marketing expense decreased by 0.4 percentage points and general and administrative expense decreased by 0.4 percentage points.
provision for (benefit from) income taxes year ended december 31,        change                % change
provision for (benefit from) income taxes       $52.7               $(81.3      )          $134.0                (165   )%
our provision for income taxes for 2019 reflects an effective tax rate of 14%, compared to an effective tax rate benefit of 32% for 2018. the provision for income taxes for 2019 was comprised primarily of an $88.8 million tax expense related to u.s. federal and state taxes, other foreign income taxes and foreign withholding taxes and a $10.1 million tax expense for an unrecognized tax benefit related to the ninth circuit's opinion in altera corporation and subsidiaries vs. commissioner of internal revenue ("altera"). the provision was partially offset by excess tax benefits of $39.3 million from stock-based compensation expense and tax benefits of $6.8 million from federal research and development tax credits.
in 2018, our effective tax rate benefit of 32% was comprised primarily of impacts related to the 2017 tax act, including a benefit of $164.0 million from the realignment of our tax structure and operations that resulted in a book-to-tax basis difference from previously taxed off-shore deferred revenue. these benefits were partially offset by a $32.6 million increase in the transition tax for finalization of the provisional estimates under staff accounting bulletin no. 118, income tax accounting implications of the tax cuts and jobs act, $20.5 million of tax expense for the impact of the gilti and $29.6 million of tax expense related to u.s. federal and state taxes, other foreign income taxes, foreign withholding taxes and a decrease in tax reserves.
quarterly results of operations the following table sets forth our unaudited quarterly statements of income data for the last eight quarters. the information for each of these quarters has been prepared on the same basis as the audited annual financial statements included elsewhere in this annual report and, in the opinion of management, includes all adjustments, which includes only normal recurring adjustments, necessary for the fair presentation of the results of operations for these periods. this data should be read in conjunction with our audited consolidated financial statements and related notes included elsewhere in this annual report. these quarterly operating results are not necessarily indicative of our operating results for any future period.
total gross profit                              473.9                423.4                393.4                359.6                378.5                342.3                328.2                301.8
provision for (benefit from) income taxes        12.5                 25.6                 13.1                  1.5                (90.5    )            11.9                  2.2                 (4.9    )
seasonality, cyclicality and quarterly revenue trends our quarterly results reflect a pattern of increased customer buying at year-end, which has positively impacted billings and product revenue activity in the fourth quarter. in the first quarter, we generally experience lower sequential customer buying, followed by an increase in buying in the second quarter. the third quarter is often consistent with the second quarter. although these seasonal factors are common in the technology sector, historical patterns should not be considered a reliable indicator of our future sales activity or performance. on a quarterly basis, we have usually generated the majority of our product revenue in the final month of each quarter and a significant amount in the last two weeks of each quarter. we believe this is due to customer buying patterns typical in this industry.
consistent with the seasonality note above, our total quarterly revenue over the past eight quarters has generally increased sequentially in each quarter, except in the first quarter of 2019 and 2018. product revenue, in each quarter in 2019, increased as compared to the same quarter in 2018, which we believe was due to investments we made in our sales and marketing organizations, continued product innovation and a robust security market. we continue to see a shift from product revenue to higher-margin, recurring service revenue.
total gross margin has fluctuated on a quarterly basis primarily due to seasonality of product sales and seasonality of cost increases. product gross margin varies based on the types of products sold and the average selling prices of our products. in 2019, product gross margin was impacted by new product introductions and the mix of high-end, mid-range and entry-level products. service gross margin benefited from the growth of our customer base and renewals.
liquidity and capital resources as of december 31,
working capital                                   $1,295.4                  $964.5                  $689.6
net cash provided by operating activities           $808.0                  $638.9                  $594.4
net cash used in investing activities               (502.3    )             (134.9    )              (76.8    )
net cash used in financing activities               (195.6    )             (202.6    )             (415.6    )
liquidity and capital resources may be impacted by our operating activities, as well as by our stock repurchases, proceeds associated with stock option exercises, issuances of common stock under our equity incentive plans and payment of taxes in connection with the net settlement of equity awards, real estate and other capital expenditures and business acquisitions.
in recent years, we have received significant capital resources from billings, the exercise of stock options and our employee stock purchase plan ("espp") purchases. additional increases in billings may depend on a number of factors, including demand for our products and services, competition, market or industry changes, and our ability to execute. we expect
proceeds from the exercise of stock options in future years to be impacted by the increased mix of restricted stock units versus stock options granted and also to vary based on our share price. there will not be future proceeds from purchases under our espp, which was terminated in february 2019. as of december 31, 2019, $1.6 billion remained available for future share repurchases under the repurchase program.
as of december 31, 2019, our cash, cash equivalents and investments of $2.21 billion were invested primarily in deposit accounts, money market funds, corporate debt securities, commercial paper, certificates of deposit and term deposits and u.s. government and agency securities. it is our investment policy to invest excess cash in a manner that preserves capital, provides liquidity and generates return without significantly increasing risk. we do not enter into investments for trading or speculative purposes.
we believe that our existing cash and cash equivalents will be sufficient to meet our anticipated cash needs for at least the next 12 months. our future capital requirements will depend on many factors, including our growth rate, the timing and amount of our share repurchases, the timing and extent of spending to support development efforts, the expansion of sales and marketing activities, the introduction of new and enhanced products and services offerings, the continuing market acceptance of our products and our investments in purchasing or leasing real estate. historically, we have required capital principally to fund our working capital needs, share repurchases, capital expenditures and acquisition activities. in the event that additional financing is required from outside sources, we may not be able to raise it on terms acceptable to us or at all.
operating activities cash generated by operating activities is our primary source of liquidity. it is primarily comprised of net income, as adjusted for non-cash items and changes in operating assets and liabilities. non-cash adjustments consist primarily of stock-based compensation, amortization of deferred contract costs and depreciation and amortization. changes in operating assets and liabilities consist primarily of changes in deferred revenue, deferred contract costs, accounts receivable and inventory.
our operating activities during 2019 provided $808.0 million in cash as a result of the continued growth of our business and our ability to successfully manage our working capital. changes in operating assets and liabilities primarily resulted from an increase in sales of our fortiguard security subscription and forticare technical support services to new and existing customers, as reflected by an increase in our deferred revenue. our total deferred revenue balance grew $449.1 million, or 27%, during 2019.
our operating activities during 2018 provided $638.9 million in cash as a result of the continued growth of our business and our ability to successfully manage our working capital. changes in operating assets and liabilities primarily resulted from an increase in sales of our fortiguard security subscription and forticare technical support services to new and existing customers, as reflected by an increase in our deferred revenue. our total deferred revenue balance as of december 31, 2018 of $1.69 billion represented a 26% increase year over year.
investing activities the changes in cash flows from investing activities primarily relate to timing of purchases, maturities and sales of investments and purchases of property and equipment. historically, in making a lease versus purchase decision related to our larger facilities, we have considered various factors including financial metrics and the impact on our employees. in certain cases, we have elected to purchase the facility if we believed that purchasing rather than leasing is more in line with our long-term strategy. we expect to make similar decisions in the future. we may also make cash payments in connection with future business combinations.
during 2019, cash used in investing activities was primarily driven by $375.5 million expended on purchases of investments, net of maturities and sales of investments, $92.2 million spent on purchases of property and equipment and $34.6 million used for the acquisitions of ensilo and cybersponse, net of cash acquired.
during 2018, cash used in investing activities was primarily due to $60.2 million spent for purchases of our investments, net of maturities and sales of investments, $53.0 million spent on capital expenditures and $21.7 million used for the acquisitions of bradford networks, inc. and zonefox limited, net of cash acquired.
financing activities the changes in cash flows from financing activities primarily relate to repurchase and retirement of common stock, proceeds from the issuance of common stock under our equity incentive plans, taxes paid related to net share settlement of equity awards and payments of debt assumed in business combinations.
during 2019, cash used in financing activities was $195.6 million, primarily due to $145.1 million used to repurchase shares of our common stock, $46.5 million used to pay tax withholding, net of proceeds, from the issuance of common stock and $3.7 million of payments of the debt assumed in business combinations.
during 2018, cash used in financing activities was $202.6 million, primarily due to $211.8 million used to repurchase shares of our common stock and $10.1 million of payments of the debt assumed in business combinations. this was partially offset by $19.3 million of proceeds from the issuance of common stock, net of tax withholding.
contractual obligations and commitments the following summarizes our inventory purchase commitments as of december 31, 2019:
inventory purchase commitments (1)   $231.9              $231.9                      $-                    $-                    $-
(1)   consists of minimum purchase commitments with independent contract manufacturers.
in addition to commitments with contract manufacturers, we have open purchase orders and contractual obligations in the ordinary course of business for which we have not received goods or services. as of december 31, 2019, we had $12.8 million in other contractual commitments having a remaining term in excess of one year that may not be cancelable.
as of december 31, 2019, we had $82.8 million of long-term income tax liabilities, including interest, related to uncertain tax positions. because of the high degree of uncertainty regarding the settlement of these liabilities, we are unable to estimate the years in which future cash outflows may occur.
off-balance sheet arrangements during 2019, 2018 and 2017, we did not have any relationships with unconsolidated organizations or financial partnerships, such as structured finance or special purpose entities that would have been established for the purpose of facilitating off-balance sheet arrangements or other contractually narrow or limited purposes.
recent accounting pronouncements see note 1 of the notes to our consolidated financial statements in part ii, item 8 of this annual report on form 10-k for a full description of recently adopted accounting pronouncements.