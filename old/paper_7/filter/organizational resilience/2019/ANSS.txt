item 7.   management's discussion and analysis of financial condition and results of operations overview overall gaap and non-gaap results our growth rates of gaap and non-gaap results for the year ended december 31, 2019 as compared to the year ended december 31, 2018 were as follows:
operating income               8.1   %                12.0       %
we experienced higher revenue during the year ended december 31, 2019 from double-digit growth in lease licenses, maintenance and service, partially driven by contributions from our recent acquisitions. we also experienced increased operating expenses primarily due to increased personnel costs, higher stock-based compensation and additional operating expenses related to acquisitions, partially offset by a reduction in expenses due to a stronger u.s. dollar.
the non-gaap results exclude the income statement effects of the acquisition accounting adjustments to deferred revenue, stock-based compensation, amortization of acquired intangible assets, transaction costs related to business combinations, and adjustments related to the transition tax associated with the tax cuts and jobs act. for further disclosure regarding non-gaap results, see the section titled "non-gaap results" immediately preceding the section titled "liquidity and capital resources."
impact of foreign currency our comparative financial results were impacted by fluctuations in the u.s. dollar during the year ended december 31, 2019 as compared to the year ended december 31, 2018. the impacts on our revenue and operating income due to currency fluctuations are reflected in the table below. amounts in brackets indicate an adverse impact from currency fluctuations.
operating income   $(10,213      )             $(11,062      )
in constant currency, our growth rates were as follows:
operating income   10.2    %                13.8   %
constant currency amounts exclude the effects of foreign currency fluctuations on the reported results. to present this information, the 2019 results for entities whose functional currency is a currency other than the u.s. dollar were converted to u.s. dollars at rates that were in effect for the 2018 comparable period, rather than the actual exchange rates in effect for 2019. constant currency growth rates are calculated by adjusting the 2019 reported revenue and operating income amounts by the 2019 currency fluctuation impacts and comparing to the 2018 comparable period reported revenue and operating income amounts.
other financial information our financial position includes $872.4 million in cash and short-term investments, and working capital of $860.3 million as of december 31, 2019.
during the year ended december 31, 2019, we repurchased 0.3 million shares for $59.1 million at an average price of $179.41 per share under our stock repurchase program.
business ansys, a delaware corporation formed in 1994, develops and globally markets engineering simulation software and services widely used by engineers, designers, researchers and students across a broad spectrum of industries and academia, including aerospace and defense, automotive, electronics, semiconductors, energy, materials and chemical processing, turbomachinery, consumer products, healthcare, and sports. headquartered south of pittsburgh, pennsylvania, we employed approximately 4,100 people as of december 31, 2019. we focus on the development of open and flexible solutions that enable users to analyze designs directly on the desktop, providing a common platform for fast, efficient and cost-conscious product development, from design concept to final-stage testing and validation. we distribute our suite of simulation technologies through a global network of independent resellers and distributors (collectively, channel partners) and direct sales offices in strategic, global locations. it is our intention to continue to maintain this hybrid sales and distribution model.
we license our technology to businesses, educational institutions and governmental agencies. growth in our revenue is affected by the strength of global economies, general business conditions, currency exchange rate fluctuations, customer budgetary constraints and the competitive position of our products. please see part i. item 1a. of this annual report on form 10-k for a complete discussion of factors that might impact our financial condition and operating results. we believe that the features, functionality and integrated multiphysics capabilities of our software products are as strong as they have ever been. however, the software business is generally characterized by long sales cycles. these long sales cycles increase the difficulty of predicting sales for any particular quarter. we make many operational and strategic decisions based upon short- and long-term sales forecasts that are impacted not only by these long sales cycles, but also by current global economic conditions. as a result, we believe that our overall performance is best measured by fiscal year results rather than by quarterly results. please see the sub-section entitled "financial risks" under part i. item 1a. of this annual report on form 10-k for additional discussion of the potential impact of our sales forecasts on our financial condition, cash flows and operating results.
management considers the competition and price pressure that it faces in the short- and long-term by focusing on expanding the breadth, depth, ease of use and quality of the technologies, features, functionality and integrated multiphysics capabilities of our software products as compared to our competitors; investing in research and development to develop new and innovative products and increase the capabilities of our existing products; supplying new products and services; focusing on customer needs, training, consulting and support; and enhancing our distribution channels. we also consider acquisitions to supplement our global engineering talent, product offerings and distribution channels.
geographic trends the following table presents our geographic constant currency revenue growth during the year ended december 31, 2019 as compared to the year ended december 31, 2018:
we continue to focus on a number of sales improvement activities across the geographic regions, including sales hiring, pipeline building, productivity initiatives and customer engagement activities.
as trade tensions between the u.s. and china continue, as well as the uncertainty around china's ability to control the coronavirus outbreak, our ability to sell and ship our products to certain customers and our ability to collect against existing trade receivables may be further restricted and could have an adverse effect on our business, results of operations or financial condition. for additional details, refer to part i. item 1a. of this annual report on form 10-k.
our three largest industries - high-tech, automotive, and aerospace and defense (a&d) - remained strong throughout 2019. the high-tech industry was positively impacted by companies' investments in 5g and smart connected products. the automotive industry continued its momentum due to continued investments by our customers to capture the disruptive mobility trends of autonomy and electrification. defense spending continued to support growth in the aerospace and defense industry.
acquisitions on november 1, 2019, we completed the acquisition of 100% of the shares of lst, the premier provider of explicit dynamics and other advanced finite element analysis technology, for a purchase price of $777.8 million. the acquisition empowers our customers to solve a new class of engineering challenges, including developing safer automobiles, aircraft and trains while reducing or even eliminating the need for costly physical testing.
on february 1, 2019, we completed the acquisition of 100% of the shares of granta design, the premier provider of materials information technology, for a purchase price of $208.7 million. the acquisition expands our portfolio into this important area, giving customers access to materials intelligence, including data that is critical to successful simulations.
additionally, during the year ended december 31, 2019, we acquired dynardo, helic and dfr solutions to combine the acquired technologies with our existing comprehensive multiphysics portfolio. these acquisitions were not individually significant. the combined purchase price of these acquisitions was $136.2 million.
during the year ended december 31, 2018, we completed the acquisition of 100% of the shares of optis, a premier provider of software for scientific simulation of light, human vision and physics-based visualization, for a purchase price of $291.0 million. the acquisition extended our portfolio into the area of optical simulation to provide comprehensive sensor solutions, covering visible and infrared light, electromagnetics and acoustics for camera, radar and lidar.
during the year ended december 31, 2017, we completed various acquisitions to expand our customer base and accelerate the development of new and innovative products to the marketplace while lowering design and engineering costs for customers. the acquisitions were not individually significant. the combined purchase price of the acquisitions was approximately $67.0 million.
for further information on our business combinations during the years ended december 31, 2019, 2018 and 2017, see note 4 to the consolidated financial statements included in part iv, item 15 of this annual report on form 10-k.
results of operations for purposes of the following discussion and analysis, the table below sets forth certain consolidated financial data for the years 2019, 2018 and 2017. the operating results of our acquisitions have been included in the results of operations since their respective acquisition dates.
software licenses                            $699,630                $576,717                $624,964
maintenance and service                       816,262                 716,919                 470,286
cost of sales:
software licenses                              23,944                  18,619                  34,421
maintenance and service                       120,619                 110,232                  78,949
total cost of sales                           166,273                 155,885                 150,164
gross profit                                1,349,619               1,137,751                 945,086
operating expenses:
research and development                      298,210                 233,802                 202,746
total operating expenses                      834,579                 661,177                 554,358
operating income                              515,040                 476,574                 390,728
effective january 1, 2018, we adopted new guidance on revenue recognition. we elected to adopt the change in accounting principle using the modified retrospective approach. results for reporting periods beginning after january 1, 2018 are presented under the new guidance, while prior period amounts are not adjusted and continue to be reported in accordance with previous guidance. for further information, see note 3 to the consolidated financial statements included in part iv, item 15 of this annual report on form 10-k.
year ended december 31,                                                          change
software licenses                          699,630                     576,717             122,913             21.3                 23.1
maintenance                                760,574                     676,883              83,691             12.4                 14.3
service                                     55,688                      40,036              15,652             39.1                 41.5
maintenance and service                    816,262                     716,919              99,343             13.9                 15.8
our revenue in the year ended december 31, 2019 increased 17.2% as compared to the year ended december 31, 2018, or 19.0% in constant currency. the growth rate was favorably impacted by our continued investments in our global sales, support and marketing organizations, as well as our 2019 and 2018 acquisitions which contributed incremental revenue of $72.9 million. lease license revenue increased 47.3%, or 49.4% in constant currency, as compared to the year ended december 31, 2018, driven primarily by an increase in multi-year lease contracts. annual maintenance contracts that were sold with new perpetual licenses, maintenance contracts for new perpetual licenses sold in previous years and the maintenance portion of lease license contracts each contributed to maintenance revenue growth of 12.4%, or 14.3% in constant currency. service revenue, driven primarily by a focus on service offerings that provide on-site mentorship on simulation best practices, training and expanding simulation adoption, increased 39.1%, or 41.5% in constant currency, as compared to the year ended december 31, 2018. perpetual license revenue, which is derived primarily from new sales during the year ended december 31, 2019, decreased 2.5%, or 1.1% in constant currency, as compared to the year ended december 31, 2018.
we continue to experience increased interest by some of our larger customers in enterprise agreements that often include longer-term, time-based licenses involving a larger number of our software products. while these arrangements typically involve a higher overall transaction price, the upfront recognition of license revenue related to these larger, multi-year transactions can result in significantly higher lease license revenue and corresponding revenue growth volatility. as software products, across a large variety of applications and industries, become increasingly distributed in software-as-a-service, cloud and other subscription environments in which the licensing approach is time-based rather than perpetual, we are also experiencing a shifting preference from perpetual licenses to time-based licenses across a broader spectrum of our customers.
with respect to revenue, on average for the year ended december 31, 2019, the u.s. dollar was approximately 3.3% stronger, when measured against our primary foreign currencies, than for the year ended december 31, 2018. the table below presents the impacts of currency fluctuations on revenue for the year ended december 31, 2019. amounts in brackets indicate an adverse impact from currency fluctuations.
the net overall stronger u.s. dollar also resulted in decreased operating income of $10.2 million for the year ended december 31, 2019 as compared to the year ended december 31, 2018.
as a percentage of revenue, our international and domestic revenues, and our direct and indirect revenues, were as follows:
in valuing deferred revenue on the balance sheets of our recent acquisitions as of their respective acquisition dates, we applied the fair value provisions applicable to the accounting for business combinations, resulting in a reduction of deferred revenue as compared to the historical carrying amount. as a result, our post-acquisition revenue will be less than the sum of what would have otherwise been reported by us and each acquiree absent the acquisitions. the impacts on reported revenue were $12.5 million and $9.4 million for the years ended december 31, 2019 and 2018, respectively. the expected impacts on reported revenue are $3.9 million and $8.0 million for the quarter ending march 31, 2020 and the year ending december 31, 2020, respectively.
cost of sales and operating expenses:
the tables below reflect our operating results as presented on the consolidated statements of income, which are inclusive of foreign currency translation impacts. amounts included in the discussions that follow each table are provided in constant currency and are inclusive of costs related to our acquisitions. the impact of foreign exchange translation is discussed separately, where material. the 2019 and 2018 acquisitions contributed $54.7 million to the overall increase in cost of sales and operating expenses with the most significant contributions from the optis (may 2, 2018) and granta design (february 1, 2019) acquisitions of $17.3 million and $18.9 million, respectively.
2019                                                                                                 2018                                            change
(in thousands, except percentages)               amount        % ofrevenue                    amount        % ofrevenue                 amount                %
cost of sales:
software licenses                          $23,944                     1.6              $18,619                     1.4            $5,325              28.6
maintenance and service                    120,619                     8.0              110,232                     8.5            10,387               9.4
total cost of sales                        166,273                    11.0              155,885                    12.1            10,388               6.7
gross profit                            $1,349,619                    89.0           $1,137,751                    87.9          $211,868              18.6
software licenses: the increase in the cost of software licenses was primarily due to increased third-party royalties of $5.6 million.
amortization: the net decrease in amortization expense was primarily due to a decrease in the amortization of trade names and acquired technology due to assets that became fully amortized, which was partially offset by the amortization of newly acquired intangible assets.
maintenance and service: the net increase in maintenance and service costs was primarily due to the following:
•   increased salaries of $4.0 million.
•   increased stock-based compensation of $3.3 million.
•   increased consulting costs of $1.7 million.
•   increased it maintenance and software hosting costs of $1.3 million.
•   decreased costs related to foreign exchange translation of $2.0 million due to a stronger u.s. dollar.
the improvement in gross profit was a result of the increase in revenue, partially offset by the increase in the related cost of sales.
2019                                                                                              2018                                    change
(in thousands, except percentages)              amount        % ofrevenue                  amount        % ofrevenue                 amount         %
operating expenses:
research and development                  298,210                    19.7            233,802                    18.1            64,408           27.5
total operating expenses                 $834,579                    55.1           $661,177                    51.1          $173,402           26.2
•   increased salaries, incentive compensation and other headcount-related costs of $63.7 million.
•   increased stock-based compensation of $13.5 million.
•   increased business travel of $6.5 million.
•   increased marketing expenses of $5.4 million.
•   increased professional fees of $4.5 million.
•   increased consulting costs of $4.2 million.
•   decreased costs related to foreign exchange translation of $7.1 million due to a stronger u.s. dollar.
we anticipate that we will continue to make targeted investments in our global sales and marketing organizations and our global business infrastructure to enhance and support our revenue-generating activities.
research and development: the increase in research and development costs was primarily due to the following:
•   increased salaries, incentive compensation and other headcount-related costs of $41.1 million.
•   increased stock-based compensation of $16.0 million.
we have traditionally invested significant resources in research and development activities and intend to continue to make investments in expanding the ease of use and capabilities of our broad portfolio of simulation software products.
interest income: interest income for the year ended december 31, 2019 was $12.8 million as compared to $11.4 million for the year ended december 31, 2018. interest income increased as a result of an increase in the average rate of return on invested cash balances.
interest expense: interest expense for the year ended december 31, 2019 was $3.5 million as compared to $0.1 million for the year ended december 31, 2018. interest expense increased as a result of the interest incurred on debt financing obtained in fiscal year 2019.
other expense, net: our other expense consisted of the following:
the decrease in the effective tax rate from the prior year was primarily due to $6.7 million of benefit related to the release of valuation allowance in a foreign jurisdiction and $1.8 million of benefit related to transition tax recorded in 2019. these benefits are offset by $6.7 million of benefit recorded in 2018 related to global legal entity restructuring activities that did not recur in 2019.
when compared to the federal and state combined statutory rate for each respective period, the effective tax rates for the years ended december 31, 2019 and 2018 were favorably impacted by tax benefits from stock-based compensation, the foreign-derived intangible income deduction, and research and development credits.
year ended december 31,                                                           change
software licenses                          576,717                     624,964             (48,247    )         (7.7   )             (8.5           )
maintenance                                676,883                     440,428             236,455              53.7                 51.6
service                                     40,036                      29,858              10,178              34.1                 33.1
maintenance and service                    716,919                     470,286             246,633              52.4                 50.4
the adoption of asc 606 significantly impacted the timing, allocation and presentation of lease license, perpetual license and maintenance revenue. for further information about this adoption, see note 3 to the consolidated financial statements included in part iv, item 15 of this annual report on form 10-k.
for purposes of comparability, the changes in the following table and the related discussion that follows are presented in accordance with asc 605.
year ended december 31,                                                  change
software licenses                          676,846                     624,964              51,882            8.3                        7.2
maintenance                                499,510                     440,428              59,082           13.4                       11.6
service                                     40,113                      29,858              10,255           34.3                       33.4
maintenance and service                    539,623                     470,286              69,337           14.7                       13.0
our asc 605 revenue in the year ended december 31, 2018 increased 11.1% as compared to the year ended december 31, 2017, while revenue grew 9.7% in constant currency. the growth rate was favorably impacted by our continued investments in our global sales, support and marketing organizations; continued progress with market segmentation and go-to-market adjustments; and the may 2018 acquisition of optis. lease license revenue increased 11.8%, or 10.7% in constant currency, as compared to the year ended december 31, 2017. perpetual license revenue, which is derived primarily from new sales during the year, increased 3.0%, or 2.0% in constant currency, as compared to the year ended december 31, 2017. annual maintenance contracts that were sold with new perpetual licenses, along with maintenance contracts for perpetual licenses sold in previous years, contributed to maintenance revenue growth of 13.4%, or 11.6% in constant currency. service revenue, driven primarily by a focus on service offerings that provide on-site mentorship on simulation best practices, training and expanding simulation adoption, increased 34.3%, or 33.4% in constant currency, as compared to the year ended december 31, 2017.
with respect to revenue, on average for the year ended december 31, 2018, the u.s. dollar was approximately 2.3% weaker and 2.6% weaker, when measured against our primary foreign currencies, than for the year ended december 31, 2017 under asc 606 and asc 605, respectively. the table below presents the impacts of currency fluctuations on revenue for the year ended december 31, 2018. amounts in brackets indicate a net adverse impact from currency fluctuations.
the net overall weaker u.s. dollar also resulted in increased operating income of $9.6 million and $10.3 million for the year ended december 31, 2018 as compared to the year ended december 31, 2017 under asc 606 and asc 605, respectively.
as a percentage of revenue, our international and domestic revenues, and our direct and indirect revenues, were as follows:
in valuing deferred revenue on the balance sheets of our recent acquisitions as of their respective acquisition dates, we applied the fair value provisions applicable to the accounting for business combinations, resulting in a reduction of deferred revenue as compared to the historical carrying amount. as a result, our post-acquisition revenue will be less than the sum of what would have otherwise been reported by us and each acquiree absent the acquisitions. under asc 606, the impact on reported revenue was $9.4 million for the year ended december 31, 2018. under asc 605, the impacts on reported revenue were $15.6 million and $2.9 million for the years ended december 31, 2018 and 2017, respectively.
cost of sales and operating expenses:
the tables below reflect our operating results as presented on the consolidated statements of income, which are inclusive of foreign currency translation impacts. the adoption of asc 606 resulted in a reclassification of expenses within cost of sales from software licenses to maintenance and service. amounts included in the discussion that follows are provided in constant currency and do not include the impact of the optis acquisition. the impact of the optis acquisition on each expense line is provided separately, where material. the impact, where material, of foreign exchange translation on each expense line is also provided separately and is inclusive of the optis acquisition.
2018                                                                                               2017                                            change
(in thousands, except percentages)               amount        % ofrevenue                  amount        % ofrevenue                 amount                %
cost of sales:
software licenses                          $18,619                     1.4            $34,421                     3.1          $(15,802    )        (45.9   )
maintenance and service                    110,232                     8.5             78,949                     7.2            31,283              39.6
total cost of sales                        155,885                    12.1            150,164                    13.7             5,721               3.8
gross profit                            $1,137,751                    87.9           $945,086                    86.3          $192,665              20.4
software licenses: the net decrease in the cost of software licenses was primarily due to the following:
•   reclassification of $18.2 million of cost of sales, previously reflected within software licenses, to maintenance and service due to the adoption of asc 606 in 2018.
•   optis-related software license expenses of $1.6 million for the period from the acquisition date (may 2, 2018) through december 31, 2018.
amortization: the decrease in amortization expense was primarily due to a net decrease in the amortization of trade names and acquired technology due to assets that became fully amortized.
maintenance and service: the increase in maintenance and service costs was primarily due to the following:
•   reclassification of $18.2 million of cost of sales, previously reflected within software licenses, to maintenance and service due to the adoption of asc 606 in 2018.
•   increased third-party technical support of $5.5 million.
•   optis-related maintenance and service expenses of $2.8 million for the period from the acquisition date (may 2, 2018) through december 31, 2018.
•   increased salaries of $2.1 million.
the improvement in gross profit was a result of the increase in revenue, partially offset by the increase in the related cost of sales.
2018                                                                                              2017                                    change
(in thousands, except percentages)              amount        % ofrevenue                  amount        % ofrevenue                 amount         %
operating expenses:
research and development                  233,802                    18.1            202,746                    18.5            31,056           15.3
total operating expenses                 $661,177                    51.1           $554,358                    50.6          $106,819           19.3
•   increased salaries, incentive compensation and other headcount-related costs of $35.2 million.
•   increased stock-based compensation of $15.3 million.
•   optis-related selling, general and administrative expenses of $13.8 million for the period from the acquisition date (may 2, 2018) through december 31, 2018.
•   increased business travel of $3.9 million.
•   increased severance expenses of $3.7 million.
•   decreased consulting costs of $7.1 million.
research and development: the net increase in research and development costs was primarily due to the following:
•   increased salaries, incentive compensation and other headcount-related costs of $15.2 million.
•   increased stock-based compensation of $11.6 million.
•   optis-related research and development expenses of $5.9 million for the period from the acquisition date (may 2, 2018) through december 31, 2018.
•   increased it maintenance and software hosting costs of $1.5 million.
•   restructuring costs of $6.8 million related to 2017 workforce realignment activities that did not reoccur in 2018.
interest income: interest income for the year ended december 31, 2018 was $11.4 million as compared to $7.0 million for the year ended december 31, 2017. interest income increased as a result of an increase in the average rate of return on invested cash balances.
other expense, net: our other expense, net consists of the following:
on december 22, 2017, the u.s. government enacted comprehensive tax legislation commonly referred to as the tax cuts and jobs act (tax reform). tax reform made broad and complex changes to the u.s. tax code, including, but not limited to, (1) reducing the u.s. federal corporate tax rate from 35 percent to 21 percent; (2) requiring companies to pay a one-time federal income tax on certain unrepatriated earnings of foreign subsidiaries (transition tax); (3) generally eliminating u.s. federal income taxes on dividends from foreign subsidiaries; (4) creating a new provision designed to tax global intangible low-taxed income (gilti) which allows for the possibility of using foreign tax credits (ftcs) and a deduction of up to 50 percent to offset the income tax liability (subject to some limitations); (5) repealing the domestic production activity deduction; (6) creating the foreign-derived intangible income deduction; (7) creating the base erosion anti-abuse tax, a new minimum tax; (8) allowing for full expensing of qualified property through bonus depreciation; and (9) creating limitations on the deductibility of certain executive compensation.
the sec staff issued staff accounting bulletin (sab) 118, which provides guidance on accounting for the tax effects of tax reform. sab 118 provided a measurement period that was limited to one year from enactment for companies to complete the accounting under asc 740, income taxes. in accordance with sab 118, throughout the measurement period, a company must reflect the income tax effects of those aspects of tax reform for which the accounting under asc 740 was complete in the financial statements. to the extent that a company's accounting for certain income tax effects of tax reform was incomplete, but a reasonable estimate was able to be made, the company must record a provisional estimate in the financial statements. if a company could not determine a provisional estimate to be included in the financial statements, it should continue to apply asc 740 on the basis of the tax laws that were in effect immediately before the enactment of tax reform.
as further discussed below, we finalized our provisional tax reform calculations as of the end of the measurement period, based on guidance and information available as of the reporting date. the u.s. government has not yet issued final guidance related to a portion of the new rules enacted as part of tax reform. subsequent adjustments, if any, will be recorded in the period in which guidance is finalized.
our accounting for the impact of the reduction in the u.s. federal corporate tax rate on our deferred tax assets and liabilities is complete. tax reform reduced the corporate tax rate to 21 percent, effective january 1, 2018. consequently, we recorded a net adjustment to deferred income tax expense of $1.9 million for the year ended december 31, 2017 to revalue our deferred tax assets and liabilities. no further adjustments were recorded for the year ended december 31, 2018.
our accounting for the transition tax is complete. reasonable estimates of certain effects were calculated and a provisional adjustment of $16.0 million was recorded in the december 31, 2017 financial statements. to determine the amount of the transition tax, we determined, in addition to other factors, the amount of post-1986 earnings and profits (e&p) of the relevant subsidiaries, as well as the amount of non-u.s. income taxes paid on such earnings. based on revised e&p calculations updated during the measurement period, we recognized an additional measurement-period adjustment for the year ended december 31, 2018 of $0.9 million to the transition tax obligation and a corresponding adjustment to tax expense.
our accounting for the indefinite reinvestment assertion is complete. in general, it is our intention to permanently reinvest all earnings in excess of previously taxed amounts. as part of tax reform, substantially all of the previous earnings of our non-u.s. subsidiaries were taxed through the transition tax and current earnings are taxed as part of gilti tax expense. these taxes increased our previously taxed earnings and allow for the repatriation of the majority of our foreign earnings without any residual u.s. federal tax. during the year ended december 31, 2018, we repatriated $144.3 million of foreign cash. we did not make any adjustments related to our indefinite reinvestment assertion during the year ended december 31, 2018.
our accounting policy choice for gilti is complete. under u.s. gaap, we are allowed to make an accounting policy choice of either (1) treating taxes due on future u.s. inclusions in taxable income related to gilti as a current-period expense when incurred (the period cost method) or (2) factoring such amounts into the measurement of our deferred taxes (the deferred method). we selected the period cost method and recorded gilti tax expense of $0.4 million in the financial statements for the year ended december 31, 2018.
the decrease in the effective tax rate from the prior year was primarily due to the reduction in the u.s. federal corporate tax rate from 35 percent to 21 percent enacted as part of tax reform, the additional $15.1 million of transition tax in 2017 when compared to 2018, and a net $6.7 million benefit related to global legal entity restructuring activities. the effective tax rate was also reduced by the foreign-derived intangible income deduction, increased research and development credits and increased stock-based compensation benefits, partially offset by the loss of the domestic manufacturing deduction, which was repealed as part of tax reform.
when compared to the federal and state combined statutory rate, the effective tax rates for the years ended december 31, 2018 and 2017 were favorably impacted by tax benefits from stock-based compensation and research and development credits.
non-gaap results we provide non-gaap revenue, non-gaap operating income, non-gaap operating profit margin, non-gaap net income and non-gaap diluted earnings per share as supplemental measures to gaap regarding our operational performance. these financial measures exclude the impact of certain items and, therefore, have not been calculated in accordance with gaap. a detailed explanation and a reconciliation of each non-gaap financial measure to our most comparable gaap financial measure are described below.
(in thousands, except percentages and per share data)           gaap results             adjustments                   non-gaap               gaap results           adjustments                   non-gaap results                                                                     results total revenue                                              $1,515,892                  $12,514         (1)      $1,528,406               $1,293,636                 $9,442         (4)      $1,303,078
operating income                                              515,040                  177,093         (2)         692,133                  476,574                141,442         (5)         618,016
operating profit margin                                          34.0      %                                          45.3    %   36.8                   %                                        47.4    %
(1)   amount represents the revenue not reported during the period as a result of the acquisition accounting adjustment associated with the accounting for deferred revenue in business combinations.
(2)   amount represents $116.2 million of stock-based compensation expense, $4.9 million of excess payroll taxes related to stock-based awards, $36.9 million of amortization expense associated with intangible assets acquired in business combinations, $6.6 million of transaction expenses related to business combinations and the $12.5 million adjustment to revenue as reflected in (1) above.
(3)   amount represents the impact of the adjustments to operating income referred to in (2) above, decreased for the related income tax impact of $61.2 million, adjustments related to the transition tax associated with the tax cuts and jobs act of $1.8 million, and rabbi trust income of $0.4 million.
(4)   amount represents the revenue not reported during the period as a result of the acquisition accounting adjustment associated with the accounting for deferred revenue in business combinations.
(5)   amount represents $83.3 million of stock-based compensation expense, $4.3 million of excess payroll taxes related to stock-based awards, $40.8 million of amortization expense associated with intangible assets acquired in business combinations, $3.5 million of transaction expenses related to business combinations and the $9.4 million adjustment to revenue as reflected in (4) above.
(6)   amount represents the impact of the adjustments to operating income referred to in (5) above, decreased for the related income tax impact of $47.9 million and increased for a measurement-period adjustment related to the tax cuts and jobs act of $0.9 million and rabbi trust expense of $0.1 million.
(in thousands, except percentages and per share data)           gaap results           adjustments               non-gaapresults               gaap results           adjustments               non-gaapresults total revenue                                              $1,216,469                $15,583         (1)      $1,232,052                  $1,095,250                 $2,856         (4)      $1,098,106
operating income                                              399,407                147,583         (2)         546,990                     390,728                118,567         (5)         509,295
operating profit margin                                          32.8      %                                        44.4       %   35.7                   %                                        46.4       %
(1)   amount represents the revenue not reported during the period as a result of the acquisition accounting adjustment associated with the accounting for deferred revenue in business combinations.
(2)   amount represents $83.3 million of stock-based compensation expense, $4.3 million of excess payroll taxes related to stock-based awards, $40.8 million of amortization expense associated with intangible assets acquired in business combinations, $3.5 million of transaction expenses related to business combinations and the $15.6 million adjustment to revenue as reflected in (1) above.
(3)   amount represents the impact of the adjustments to operating income referred to in (2) above, decreased for the related income tax impact of $49.7 million and increased for a measurement-period adjustment related to the tax cuts and jobs act of $0.9 million and rabbi trust expense of $0.1 million.
(4)   amount represents the revenue not reported during the period as a result of the acquisition accounting adjustment associated with the accounting for deferred revenue in business combinations.
(5)   amount represents $53.2 million of stock-based compensation expense, $49.8 million of amortization expense associated with intangible assets acquired in business combinations, $11.7 million of restructuring charges, $1.1 million of transaction expenses related to business combinations and the $2.9 million adjustment to revenue as reflected in (4) above.
(6)   amount represents the impact of the adjustments to operating income referred to in (5) above, decreased for the related income tax impact of $52.5 million, excluding the impact of the tax cuts and jobs act, and rabbi trust income of $0.1 million, and increased for total net impacts of the tax cuts and jobs act of $22.7 million.
non-gaap measures we use non-gaap financial measures (a) to evaluate our historical and prospective financial performance as well as our performance relative to our competitors, (b) to set internal sales targets and spending budgets, (c) to allocate resources, (d) to measure operational profitability and the accuracy of forecasting, (e) to assess financial discipline over operational expenditures and (f) as an important factor in determining variable compensation for management and employees. in addition, many financial analysts that follow us focus on and publish both historical results and future projections based on non-gaap financial measures. we believe that it is in the best interest of our investors to provide this information to analysts so that they accurately report the non-gaap financial information. moreover, investors have historically requested, and we have historically reported, these non-gaap financial measures as a means of providing consistent and comparable information with past reports of financial results.
while we believe that these non-gaap financial measures provide useful supplemental information to investors, there are limitations associated with the use of these non-gaap financial measures. these non-gaap financial measures are not prepared in accordance with gaap, are not reported by all our competitors and may not be directly comparable to similarly titled measures of our competitors due to potential differences in the exact method of calculation. we compensate for these limitations by using these non-gaap financial measures as supplements to gaap financial measures and by reviewing the reconciliations of the non-gaap financial measures to their most comparable gaap financial measures.
the adjustments to these non-gaap financial measures, and the basis for such adjustments, are outlined below:
acquisition accounting for deferred revenue and its related tax impact. historically, we have consummated acquisitions in order to support our strategic and other business objectives. in accordance with the fair value provisions applicable to the accounting for business combinations, acquired deferred revenue is often recorded on the opening balance sheet at an amount that is lower than the historical carrying value. although this acquisition accounting requirement has no impact on our business or cash flow, it adversely impacts our reported gaap revenue in the reporting periods following an acquisition. in order to provide investors with financial information that facilitates comparison of both historical and future results, we provide non-gaap financial measures which exclude the impact of the acquisition accounting adjustment. we believe that this non-gaap financial adjustment is useful to investors because it allows investors to (a) evaluate the effectiveness of the methodology and information used by us in our financial and operational decision-making, and (b) compare our past and future reports of financial results as the revenue reduction related to acquired deferred revenue will not recur when related annual lease licenses and software maintenance contracts are renewed in future periods.
amortization of intangible assets from acquisitions and its related tax impact. we incur amortization of intangible assets, included in our gaap presentation of amortization expense, related to various acquisitions we have made. we exclude these expenses and their related tax impact for the purpose of calculating non-gaap operating income, non-gaap operating profit margin, non-gaap net income and non-gaap diluted earnings per share when we evaluate our continuing operational performance because these costs are fixed at the time of an acquisition, are then amortized over a period of several years after the acquisition and generally cannot be changed or influenced by us after the acquisition. accordingly, we do not consider these expenses for purposes of evaluating our performance during the applicable time period after the acquisition, and we exclude such expenses when making decisions to allocate resources. we believe that these non-gaap financial measures are useful to investors because they allow investors to (a) evaluate the effectiveness of the methodology and information used by us in our financial and operational decision-making, and (b) compare our past reports of financial results as we have historically reported these non-gaap financial measures.
stock-based compensation expense and its related tax impact. we incur expense related to stock-based compensation included in our gaap presentation of cost of software licenses; cost of maintenance and service; research and development expense; and selling, general and administrative expense. this non-gaap adjustment also includes excess payroll tax expense related to stock-based compensation. stock-based compensation expense (benefit) incurred in connection with our deferred compensation plan held in a rabbi trust includes an offsetting benefit (charge) recorded in other income (expense). although stock-based compensation is an expense and viewed as a form of compensation, we exclude these expenses for the purpose of calculating non-gaap operating income, non-gaap operating profit margin, non-gaap net income and non-gaap diluted earnings per share when we evaluate our continuing operational performance. we similarly exclude income (expense) related to assets held in a rabbi trust in connection with our deferred compensation plan. specifically, we exclude stock-based compensation and income (expense) related to assets held in the deferred compensation plan rabbi trust during our annual budgeting process and our quarterly and annual assessments of our performance. the annual budgeting process is the primary mechanism whereby we allocate resources to various initiatives and operational requirements. additionally, the annual review by our board of directors during which it compares our historical business model and profitability to the planned business model and profitability for the forthcoming year excludes the impact of stock-based compensation. in evaluating the performance of our senior management and department managers, charges related to stock-based compensation are excluded from expenditure and profitability results. in fact, we record stock-based compensation expense into a stand-alone cost center for which no single operational manager is responsible or accountable. in this way, we can review, on a period-to-period basis, each manager's performance and assess financial discipline over operational expenditures without the effect of stock-based compensation. we believe that these non-gaap financial measures are useful to investors because they allow investors to (a) evaluate our operating results and the effectiveness of the methodology used by us to review our operating results, and (b) review historical comparability in our financial reporting as well as comparability with competitors' operating results.
restructuring charges and the related tax impact. we occasionally incur expenses for restructuring our workforce included in our gaap presentation of cost of software licenses; cost of maintenance and service; research and development expense; and selling, general and administrative expense. we exclude these expenses for the purpose of calculating non-gaap operating income, non-gaap operating profit margin, non-gaap net income and non-gaap diluted earnings per share when we evaluate our continuing operational performance, as we generally do not incur these expenses as a part of our operations. we believe that these non-gaap financial measures are useful to investors because they allow investors to (a) evaluate our operating results and the effectiveness of the methodology used by us to review our operating results, and (b) review historical comparability in our financial reporting as well as comparability with competitors' operating results.
transaction costs related to business combinations. we incur expenses for professional services rendered in connection with business combinations, which are included in our gaap presentation of selling, general and administrative expense. these expenses are generally not tax-deductible. we exclude these acquisition-related transaction expenses, derived from announced acquisitions, for the purpose of calculating non-gaap operating income, non-gaap operating profit margin, non-gaap net income and non-gaap diluted earnings per share when we evaluate our continuing operational performance, as we generally would not have otherwise incurred these expenses in the periods presented as a part of our operations. we believe that these non-gaap financial measures are useful to investors because they allow investors to (a) evaluate our operating results and the effectiveness of the methodology used by us to review our operating results, and (b) review historical comparability in our financial reporting as well as comparability with competitors' operating results.
tax cuts and jobs act. we recorded impacts to our income tax provision related to the enactment of the tax cuts and jobs act, specifically for the transition tax related to unrepatriated cash and the impacts of the tax rate change on net deferred tax assets. we exclude these impacts for the purpose of calculating non-gaap net income and non-gaap diluted earnings per share when we evaluate our continuing operational performance, as (i) the charges are not expected to recur as part of our normal operations and (ii) the charges resulted from the extremely infrequent event of major u.s. tax reform, the last such reform having occurred in 1986. we believe that these non-gaap financial measures are useful to investors because they allow investors to (a) evaluate our operating results and the effectiveness of the methodology used by us to review our operating results, and (b) review historical comparability in our financial reporting.
non-gaap financial measures are not in accordance with, or an alternative for, gaap. our non-gaap financial measures are not meant to be considered in isolation or as a substitute for comparable gaap financial measures and should be read only in conjunction with our consolidated financial statements prepared in accordance with gaap.
we have provided a reconciliation of the non-gaap financial measures to the most directly comparable gaap financial measures as listed below:
gaap reporting measure       non-gaap reporting measure revenue                      non-gaap revenue operating income             non-gaap operating income operating profit margin      non-gaap operating profit margin net income                   non-gaap net income diluted earnings per share   non-gaap diluted earnings per share liquidity and capital resources as of december 31,   change
working capital                                            $860,340                $786,410        $73,930              9.4
cash, cash equivalents and short-term investments cash and cash equivalents consist primarily of highly liquid investments such as money market funds and deposits held at major banks. short-term investments consist primarily of deposits held by certain of our foreign subsidiaries with original maturities of three months to one year. the following table presents our foreign and domestic holdings of cash, cash equivalents and short-term investments:
as of december 31,
(in thousands, except percentages)              2019        % of total   2018                       % of total domestic                                $626,433                  71.8          $616,249                  79.3
in general, it is our intention to permanently reinvest all earnings in excess of previously taxed amounts. as part of tax reform, substantially all of the previous earnings of our non-u.s. subsidiaries were taxed through the transition tax and current earnings are taxed as part of gilti tax expense. these taxes increased our previously taxed earnings and allow for the repatriation of the majority of our foreign earnings without any residual u.s. federal tax. while we believe that the financial reporting bases may be greater than the tax bases of investments in foreign subsidiaries for any earnings in excess of previously taxed amounts, such amounts are considered permanently reinvested. the cumulative temporary difference related to such permanently reinvested earnings is approximately $32.8 million and we would anticipate the tax effect on those earnings to be immaterial as a result of tax reform.
the amount of cash, cash equivalents and short-term investments held by foreign subsidiaries is subject to translation adjustments caused by changes in foreign currency exchange rates as of the end of each respective reporting period, the offset to which is recorded in accumulated other comprehensive loss on our consolidated balance sheet.
cash flows from operating activities year ended december 31,                                       change
net cash provided by operating activities          $499,936                $484,988                $427,660            $14,948                 $57,328
net cash provided by operating activities increased during the current fiscal year due to increased net income (net of non-cash operating adjustments) of $107.4 million, partially offset by decreased net cash flows from operating assets and liabilities of $92.4 million.
net cash provided by operating activities increased during the prior fiscal year due to increased net income (net of non-cash operating adjustments) of $151.4 million, partially offset by decreased net cash flows from operating assets and liabilities of $94.1 million.
cash flows from investing activities year ended december 31,                                            change
net cash used in investing activities increased during the current fiscal year due primarily to increased acquisition-related net cash outlays of $504.2 million and increased capital expenditures of $23.2 million. we currently plan capital spending of $45.0 million to $55.0 million during fiscal year 2020 as compared to the $44.9 million that was spent in fiscal year 2019. the level of spending will depend on various factors, including the growth of the business and general economic conditions.
net cash used in investing activities increased during the prior fiscal year due primarily to increased acquisition-related net cash outlays of $219.1 million.
cash flows from financing activities year ended december 31,                                       change
net cash provided by financing activities increased during the current fiscal year due primarily to $500.0 million in proceeds from long-term debt obtained in fiscal year 2019 related to the lst acquisition and decreased stock repurchases of $210.7 million, partially offset by increased restricted stock unit withholding taxes paid in lieu of issuing shares of $13.6 million.
net cash used in financing activities decreased during the prior fiscal year due primarily to decreased stock repurchases of $66.2 million, partially offset by increased restricted stock unit withholding taxes paid in lieu of issuing shares of $17.8 million and decreased proceeds from shares issued for stock-based compensation of $11.5 million.
other cash flow information we believe that existing cash and cash equivalent balances of $872.1 million, together with cash generated from operations and access to the $500.0 million revolving credit facility, will be sufficient to meet our working capital and capital expenditure requirements through the next twelve months. our cash requirements in the future may also be financed through additional equity or debt financings. there can be no assurance that such financings can be obtained on favorable terms, if at all. we repaid $75.0 million of our unsecured term loan in january 2020 prior to its scheduled maturity date.
under our stock repurchase program, we repurchased shares as follows:
number of shares repurchased                  330                   1,674                   2,750
in february 2018, our board of directors increased the number of shares authorized for repurchase to a total of 5.0 million shares under the stock repurchase program. as of december 31, 2019, 3.5 million shares remained available for repurchase under the program.
the authorized repurchase program does not have an expiration date, and the pace of the repurchase activity will depend on factors such as working capital needs, cash requirements for acquisitions, our stock price, and economic and market conditions. our stock repurchases may be effected from time to time through open market purchases or pursuant to a rule 10b5-1 plan.
we continue to generate positive cash flows from operating activities and believe that the best uses of our excess cash are to invest in the business; acquire or make investments in complementary companies, products, services and technologies; and make payments on our outstanding debt balances. any future acquisitions may be funded by available cash and investments, cash generated from operations, debt financing, or the issuance of additional securities. additionally, we have in the past, and expect in the future, to repurchase stock in order to both offset dilution and return capital, in excess of our requirements, to stockholders with the goal of increasing stockholder value.
off-balance-sheet arrangements we do not have any special-purpose entities or off-balance-sheet arrangements.
contractual obligations our significant contractual obligations as of december 31, 2019 are summarized below:
global headquarters operating lease(3)                                                     45,199                 4,464                    8,928                   8,944             22,863
other operating leases(4)                                                                  83,566                17,153                   27,127                  15,990             23,296
(1)   we repaid $75.0 million of the unsecured term loan in january 2020 prior to its scheduled maturity date. as such, the payment is reflected as current on our consolidated balance sheet but not in the table above.
(2)   interest on the long-term debt is estimated using the interest rate as of december 31, 2019, as the interest rate is variable. for additional information, see note 10 to the consolidated financial statements included in part iv, item 15 of this annual report on form 10-k. the interest payments reflected in the table above have not been reduced for the effect of the $75.0 million principal payment discussed in (1) above.
(3)   we previously entered into a lease agreement for 186,000 square feet of rentable space located in an office facility in canonsburg, pennsylvania, which serves as our headquarters. the term of the lease is 183 months, beginning on october 1, 2014 and expiring on december 31, 2029. we have a one-time right to terminate the lease on december 31, 2025 by providing the landlord with at least 18 months' prior written notice of such termination.
(4)   other operating leases primarily include noncancellable lease commitments for our other domestic and international offices as well as certain operating equipment.
(5)   unconditional purchase obligations primarily include royalties and software licenses and services, which are unrecorded as of december 31, 2019.
(6)   we have $64.4 million of unrecognized tax benefits, including estimated interest and penalties, that have been recorded as liabilities in accordance with income tax accounting guidance for which we are uncertain as to if or when such amounts may be settled. as a result, such amounts are excluded from the table above.
(7)   other long-term obligations primarily include third-party commissions of $28.3 million; post-employment benefits, including pension obligations, of $12.7 million for certain foreign locations; and office space restoration of $3.1 million. these amounts include the related current portions when applicable.
critical accounting policies and estimates we believe that the following critical accounting policies affect the more significant judgments and estimates used in the preparation of our consolidated financial statements.
revenue recognition: our revenue is derived principally from the licensing of computer software products and from related maintenance contracts. we adopted asc 606 on january 1, 2018 using the modified retrospective approach for all contracts not completed as of the date of adoption. results for reporting periods beginning after january 1, 2018 are presented under asc 606, while prior period amounts are not adjusted and continue to be reported in accordance with asc 605. the adoption of asc 606 represents a change in accounting principle that will more closely align revenue recognition with the delivery of our software licenses, maintenance and services.
revenue recognition policy 2019 and 2018 (asc 606)
we enter into contracts that include combinations of products, maintenance and services, which are accounted for as separate performance obligations with differing revenue recognition patterns.
revenue from perpetual licenses is classified as software license revenue. software license revenue is recognized up front upon delivery of the licensed product and/or the utility that enables the customer to access authorization keys, provided that an enforceable contract has been received. typically, our perpetual licenses are sold with post-contract support (pcs), which includes unspecified technical enhancements and customer support. we allocate value in bundled perpetual and pcs arrangements based on the standalone selling prices of the perpetual license and pcs. revenue from pcs is classified as maintenance revenue and is recognized ratably over the term of the contract, as we satisfy the pcs performance obligation over time.
in addition to perpetual licenses, we sell time-based lease licenses. lease licenses are sold only as a bundled arrangement that includes the rights to a term software license and pcs. utilizing observable inputs, we determined that 50% of the estimated standalone selling price of the lease license is attributable to the term license and 50% is attributable to the pcs. this determination considered the value relationship for our products between pcs to time-based lease licenses, the value relationship between pcs and perpetual licenses, the average economic life of our products, software renewal rates and the price of the bundled arrangement in relation to the perpetual licensing approach. consistent with the perpetual sales, the license component is classified as software license revenue and recognized as revenue up front at the commencement of the lease upon delivery of the licensed product and/or utility that enables the customer to access authorization keys. the pcs is classified as maintenance revenue and is recognized ratably over the term of the contract, as we provide the pcs benefit over time.
revenue from training, support and other services is recognized as the services are performed. for contracts in which the service consists of a single performance obligation, such as providing a training class to a customer, we recognize revenue upon completion of the performance obligation. for service contracts that are longer in duration and often include multiple performance obligations (for example, both training and consulting), we measure the progress toward completion of the obligations and recognize revenue accordingly. in measuring progress towards the completion of performance obligations, we typically utilize output-based estimates for services with contractual billing arrangements that are not based on time and materials, and estimate output based on the total tasks completed as compared to the total tasks required for each work contract. input-based estimates are utilized for services that involve general consultations with contractual billing arrangements based on time and materials, utilizing direct labor as the input measure. proceeds from customers for the purpose of expediting road-map items, developing new products or creating specific features and functionality for existing products is classified as revenue.
we also execute arrangements through independent channel partners in which the channel partners are authorized to market and distribute our software products to end users of our products and services in specified territories. in sales facilitated by channel partners, the channel partner bears the risk of collection from the end-user customer. we recognize revenue from transactions with channel partners in a manner consistent with the direct sales described above for both perpetual and time-based licenses. revenue from channel partner transactions is the amount remitted to us by the channel partners. this amount includes a fee for pcs that is compensation for providing technical enhancements and the second level of technical support to the end user, which is recognized over the period that pcs is to be provided.
non-income related taxes collected from customers and remitted to governmental authorities are recorded on the consolidated balance sheet as accounts receivable and accrued expenses. the collection and payment of these amounts are reported on a net basis in the consolidated statements of income and do not impact reported revenues or expenses.
we do not offer right of return. we warrant to our customers that our software will perform substantially as specified in our current user manuals. we have not experienced significant claims related to software warranties beyond the scope of maintenance support, which we are already obligated to provide. the warranty is not sold, and cannot be purchased, separately. the warranty does not provide any type of additional service to the customer or performance obligation for us.
our agreements with our customers generally require us to indemnify the customer against claims that our software infringes third-party patent, copyright, trademark or other proprietary rights. such indemnification obligations are generally limited in a variety of industry-standard respects, including our right to replace an infringing product.
our contracts with customers typically include promises to transfer licenses and services to a customer. judgment is required to determine if the promises are separate performance obligations, and if so, to allocate the transaction price to each performance obligation. we use the estimated standalone selling price method to allocate the transaction price for each performance obligation. the estimated standalone selling price is determined using all information reasonably available to us, including market conditions and other observable inputs. the corresponding revenues are recognized as the related performance obligations are satisfied.
we apply a practical expedient to expense sales commissions as incurred when the amortization period would have been one year or less. sales commissions associated with the initial year of multi-year contracts are expensed as incurred due to their immateriality. sales commissions associated with multi-year contracts beyond the initial year are subject to an employee service requirement and are expensed as incurred as they are not considered incremental costs to obtain a contract.
we are required to adjust promised amounts of consideration for the effects of the time value of money if the timing of the payments provides the customer or us with a significant financing benefit. we consider various factors in assessing whether a financing component exists, including the duration of the contract, market interest rates and the timing of payments. our contracts do not include a significant financing component requiring adjustment to the transaction price.
revenue recognition policy 2017 (asc 605)
revenue from perpetual licenses was classified as license revenue and was recognized upon delivery of the licensed product and/or the utility that enabled the customer to access authorization keys, provided that acceptance had occurred and a signed contractual obligation was received, the price was fixed and determinable, and collectibility of the receivable was probable. we determined the fair value of pcs sold together with perpetual licenses based on the rate charged for pcs when sold separately. revenue from pcs contracts was classified as maintenance and service revenue and was recognized ratably over the term of the contract.
revenue for software lease licenses was classified as license revenue and was recognized over the period of the lease contract. typically, our software leases include pcs which, due to the short term (principally one year or less) of our software lease licenses, were not permitted to be separated from lease revenue for accounting purposes. as a result, both the lease licenses and pcs were recognized ratably over the lease period. we included the revenue for the entire lease arrangement within software license revenue in the consolidated statements of income.
many of our semiconductor products are typically licensed via longer term leases of 24-36 months. we recognized revenue for these licenses over the term of the lease contract. because we did not have vendor-specific objective evidence of the fair value of these leases, we also recognized revenue from perpetual licenses over the term of the lease contract during the infrequent occurrence of these licenses being sold with semiconductor leases in multiple-element arrangements.
revenue from training, support and other services was recognized as the services were performed. we applied the specific performance method to contracts in which the service consisted of a single act, such as providing a training class to a customer, and the proportional performance method to other service contracts that were longer in duration and often included multiple acts (for example, both training and consulting). in applying the proportional performance method, we typically utilized output-based estimates for services with contractual billing arrangements that were not based on time and materials, and estimated output based on the total tasks completed as compared to the total tasks required for each work contract. input-based estimates were utilized for services that involved general consultations with contractual billing arrangements based on time and materials, utilizing direct labor as the input measure.
the accounting treatment under asc 605 associated with arrangements through independent channel partners, non-income related taxes, warranties and indemnification obligations is consistent with the accounting treatment under asc 606 described above.
goodwill and other intangible assets: we test goodwill and indefinite-lived intangible assets for impairment at least annually by performing a quantitative assessment of whether the fair value of each reporting unit or asset exceeds its carrying amount. we have one reporting unit. goodwill is tested at this reporting unit level and indefinite-lived intangible assets are tested at the individual asset level. this requires us to assess and make judgments regarding a variety of factors which impact the fair value of the reporting unit or asset being tested, including business plans, anticipated future cash flows, economic projections and other market data. because there are inherent uncertainties involved in these factors, significant differences between these estimates and actual results could result in future impairment charges and could materially impact our future financial results. during the first quarter of 2019, we completed the annual impairment test for goodwill and the indefinite-lived intangible asset and determined that these assets had not been impaired as of the test date, january 1, 2019. no other events or circumstances changed during the year ended december 31, 2019 that would indicate that the fair values of our reporting unit and indefinite-lived intangible asset are below their carrying values.
intangible assets are recognized apart from goodwill whenever an acquired intangible asset arises from contractual or other legal rights, or whenever it is capable of being separated or divided from the acquired entity and sold, transferred, licensed, rented, or exchanged, either individually or in combination with a related contract, asset or liability. we determined the fair value of our intangible assets using various valuation techniques, including the relief-from-royalty method and the multi-period excess earnings method. these models utilize certain unobservable inputs classified as level 3 measurements as defined by asc 820, fair value measurements and disclosures. the determination of fair value requires considerable judgment and is sensitive to changes in underlying assumptions, estimates and market factors. estimating fair value requires us to make assumptions and estimates regarding our future plans, as well as industry and economic conditions. these assumptions and estimates include, but are not limited to: royalty rate, discount rate and attrition rate. the fair values of the intangible assets will be amortized over their useful lives. impairment losses are recognized if the carrying amounts of finite-lived intangible assets are both not recoverable and exceed the fair values.
income taxes: we account for income taxes under the asset and liability method, which requires the recognition of deferred tax assets and liabilities for the expected future tax consequences of events that have been included in the financial statements. under this method, deferred tax assets and liabilities are determined based on the differences between the financial statement and tax bases of assets and liabilities using enacted tax rates in effect for the year in which the differences are expected to reverse. the effect of a change in tax rates on deferred tax assets and liabilities is recognized in income in the period of the enactment date.
we record net deferred tax assets to the extent we believe these assets will more likely than not be realized. in making such determination, we consider all available positive and negative evidence, including scheduled reversals of deferred tax liabilities, projected future taxable income, tax planning strategies and recent financial operations. in the event we determine that we will be able to realize deferred tax assets for which a valuation allowance was used to reduce their carrying value, the adjustment to the valuation allowance will be recorded as a reduction to the provision for income taxes.
tax benefits related to uncertain tax positions taken or expected to be taken on a tax return are recorded when such benefits meet a more-likely-than-not threshold. otherwise, these tax benefits are recorded when a tax position has been effectively settled, which means that the statute of limitations has expired or the appropriate taxing authority has completed its examination even though the statute of limitations remains open.
we recognize interest and penalties related to income taxes within the income tax expense line in the consolidated statements of income. accrued interest and penalties are included within the related tax liability line in the consolidated balance sheets.
stock-based compensation: we grant restricted stock units and other stock awards to employees and directors under our equity incentive plan. eligible employees can also purchase shares of our common stock at a discount under our employee stock purchase plan. the benefits provided under these plans are stock-based payments subject to the provisions of stock-based payment accounting guidance. we use the fair value method to apply the provisions of stock-based payment accounting guidance. stock-based compensation expense for 2019, 2018 and 2017 was $116.2 million, $83.3 million and $53.2 million, respectively. as of december 31, 2019, total unrecognized estimated compensation expense related to awards granted prior to that date was $186.4 million, which is expected to be recognized over a weighted average period of 1.5 years.
prior to 2017, we granted stock option awards. the value of each stock option award was estimated on the date of grant, or date of acquisition for options issued in a business combination, using the black-scholes option pricing model (black-scholes model). the determination of the fair value of stock-based payment awards using an option pricing model was affected by our stock price as well as assumptions regarding a number of complex and subjective variables. these variables included our stock volatility during the preceding six years, actual and projected employee stock option exercise behaviors, interest rate assumptions using the five-year u.s. treasury note yield on the date of grant or acquisition date, and expected dividends. the stock-based compensation expense for options is recorded ratably over the requisite service period.
we issue various restricted stock unit awards which contain either a market condition, a performance condition, a service condition, or certain combinations of the three. restricted stock unit awards are valued based on the grant-date fair value of the award. stock-based compensation expense is recognized over the employee's requisite service period for awards with only a service condition. for awards with a performance condition, stock-based compensation expense is recorded from the service inception date through the conclusion of the measurement period based on management's estimates concerning the probability of vesting.
vesting of restricted stock unit awards with a market condition is based on our performance as measured by total stockholder return relative to the appreciation of a specified stock index over the measurement period, subject to each participant's continued employment through the conclusion of the measurement period. the fair value of the restricted stock unit awards with a market condition is estimated using a monte carlo simulation model. the determination of the fair value of the awards is affected by the grant date and several variables, each of which has been identified in the chart below. stock-based compensation expense based on the fair value of the award is recorded from the grant date through the conclusion of the measurement period.
risk-free interest rate                                      2.5%               2.4%               1.5%
expected volatility-ansys stock price                         23%                21%                19%
expected volatility-nasdaq composite index                    16%                15%                15%
expected term                                           2.8 years          2.8 years          2.8 years correlation factor                                           0.71               0.65               0.70
we also grant restricted stock units to non-employee directors, which vest upon the earlier of one year from the date of grant or the date of the next regular annual meeting of stockholders. if a non-employee director retires prior to the vest date, the non-employee director receives a pro-rata portion of the restricted stock units.
to the extent we change the terms of our stock-based compensation programs, experience market volatility in the pricing of our common stock that increases the implied volatility assumption used in the pricing models, refine different assumptions, or assume stock awards from acquired companies that are different in nature than our stock award arrangements, among other potential impacts, the stock-based compensation expense recorded in future periods and the related tax benefits may differ significantly from what was recorded in previous reporting periods. forfeitures of awards are accounted for as they occur.
estimates of stock-based compensation expense are significant to our financial statements, but this expense is partially based on the aforementioned option valuation and monte carlo simulation models and will never result in the payment of cash by us other than through the payment of withholding taxes in lieu of additional share issuance. for this reason, and because we do not view stock-based compensation as related to our operational performance, the board of directors and management exclude stock-based compensation expense when evaluating our underlying business performance.
contingencies: we are involved in various investigations, claims and legal proceedings that arise in the ordinary course of business, including commercial disputes, labor and employment matters, tax audits, alleged infringement of intellectual property rights and other matters. we review the status of these matters, assess our financial exposure and record a related accrual if the potential loss from an investigation, claim or legal proceeding is probable and the amount is reasonably estimable. significant judgment is involved in the determination of probability and in the determination of whether an exposure is reasonably estimable. as a result of the uncertainties involved in making these estimates, we may have to revise our estimates as facts and circumstances change. the revision of these estimates could have a material impact on our financial position and results of operations.
recent accounting guidance for information regarding recent accounting guidance and its impact on our consolidated financial statements, see note 2 to the consolidated financial statements in part iv, item 15 of this annual report on form 10-k.