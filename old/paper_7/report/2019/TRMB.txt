item 7. management's discussion and analysis of financial condition and results of operations the following discussion should be read in conjunction with the consolidated financial statements and the related notes. the following discussion contains forward-looking statements that reflect our plans, estimates, and beliefs. our actual results could differ materially from those discussed in the forward-looking statements. factors that could cause or contribute to these differences include, but are not limited to, those discussed below and those listed under "risks factors." this section of this form 10-k generally discusses 2019 and 2018 items and year-to-year comparisons between 2019 and 2018. discussions of 2017 items and year-to-year comparisons between 2018 and 2017 that are not included in this form 10-k can be found in "management's discussion and analysis of financial condition and results of operations" in part ii, item 7 of the company's annual report on form 10-k for the fiscal year ended december 28, 2018.
executive level overview trimble began operations in 1978 and was originally incorporated in california as trimble navigation limited in 1981. on october 1, 2016, trimble navigation limited changed its name to trimble inc. and changed its state of incorporation from the state of california to the state of delaware.
trimble is a leading provider of technology solutions that enable professionals and field mobile workers to improve or transform their work processes. our comprehensive work process solutions are used across a range of industries including agriculture, architecture, civil engineering, survey and land administration, construction, geospatial, government, natural resources, transportation, and utilities. representative trimble customers include engineering and construction firms, contractors, owners, surveying companies, farmers and agricultural companies, trucking companies, energy, utility companies, and state, federal, and municipal governments.
trimble focuses on integrating its broad technological and application capabilities to create vertically-focused, system-level solutions that transform how work is done within the industries we serve. the integration of sensors, software, connectivity, and information in our portfolio gives us the unique ability to provide an information model specific to the customer's workflow. for example, in construction, our strategy is centered on the concept of a "constructible model" that is at the center of our "connected construction" solutions, which provides real-time, connected, and cohesive information environments for the design, build, and operational phases of construction projects. in agriculture, we continue to develop "connected farm" solutions to optimize operations across the agriculture workflow. in long haul trucking, our "connected fleet" solutions provide transportation companies with tools to enhance fuel efficiency, safety, and transparency through connected vehicles and fleets across the enterprise.
our growth strategy is centered on multiple elements:
•   focus on attractive markets with significant growth and profitability potential - we focus on large markets historically underserved by technology that offer significant potential for long-term revenue growth, profitability, and market leadership. our core industries such as construction, agriculture, and transportation markets are each multi-trillion dollar global industries that operate in increasingly demanding environments with technology adoption in the early phases relative to other industries. with the emergence of mobile computing capabilities, the increasing technological know-how of end users and the compelling return on investment to our customers, we believe many of our markets are attractive for substituting trimble's technology and solutions in place of traditional operating methods.
•   domain knowledge and technological innovation that benefit a diverse customer base - we have redefined our technological focus from hardware-driven point solutions to integrated work process solutions by developing domain expertise and heavily reinvesting in r&amp;d and acquisitions. we have been spending approximately 14% of revenue over the past two years on r&amp;d and currently have over 1,200 unique patents. we intend to continue to take advantage of our technology portfolio and deep domain knowledge to quickly and cost-effectively deliver specific, targeted solutions to each of the vertical markets we serve. we look for opportunities where the potential for technological change is high and that have a requirement for the integration of multiple technologies into complete vertical solutions.
•   increasing focus on software and subscription offerings - software and subscription services are increasingly important elements of our solutions and are core to our growth strategy. trimble has an open application programming interface philosophy and open vendor environment, which leads to increased adoption of our software and subscription offerings. we believe that increased recurring revenue from these solutions will provide us with enhanced business visibility over time. professional services constitute an additional growth channel that helps our customers integrate and optimize the use of our offerings in their environment.
•   geographic expansion with localization strategy - we view international expansion as an important element of our strategy, and we continue to position ourselves in geographic markets that will serve as important sources of future growth. we currently have a physical presence in over 40 countries and distribution channels over 85 countries.
•   optimized go-to-market strategies to best access our markets - we utilize vertically focused distribution channels that leverage domain expertise to best serve the needs of individual markets both domestically and abroad. these channel capabilities include independent dealers, joint ventures, original equipment manufacturers ("oem"), and sales and distribution alliances with key partners, such as cnh global, caterpillar, and nikon, as well as direct sales to end-users. this provides us with broad market reach and localization capabilities to effectively serve our markets.
•   strategic acquisitions - organic growth continues to be our primary focus, while acquisitions serve to enhance our market position. we acquire businesses that bring domain expertise, technology, products, or distribution capabilities that augment our portfolio and allow us to penetrate existing markets more effectively, or to establish a market beachhead. our success in targeting and effectively integrating acquisitions is an important aspect of our growth strategy.
trimble's focus on these growth drivers has led over time to growth in revenue and profitability as well as an increasingly diversified business model. software and subscription growth is driving increased recurring revenue, leading to improved visibility in some of our businesses. as our solutions have expanded, our go-to-market model has also evolved, with a balanced mix between direct, distribution, and oem customers, and an increasing number of enterprise level customer relationships.
during fiscal 2019, the company acquired four businesses with total purchase consideration of $247.0 million. the largest acquisition was cityworks, which we acquired in the fourth quarter of 2019. cityworks is a provider of enterprise asset management (eam) software for utilities and local government.
during fiscal 2018, we acquired six businesses with total cash consideration of $1.8 billion. the largest acquisition was viewpoint, which we acquired in the third quarter of 2018 with total cash consideration of $1.2 billion. viewpoint is a provider of construction management software, which integrates a contractor's financial and resource management to their project operations in the field. the acquisition is highly complementary to our construction technology portfolio and positions us to further our strategy to lead the industry's transformation. with viewpoint, we offer customers a central workflow platform for delivering integrated end-to-end construction management, while further enabling connectivity across the complete construction life cycle.
in january 2020, a novel strain of coronavirus was identified in china, resulting in shutdowns of manufacturing and commerce, as well as global travel restrictions to contain the virus. the impact has extended to other regions. we have suppliers and employees in china, and the region represents an end market for our products. our customers and suppliers within china and other impacted countries are also affected by the coronavirus related restrictions and closures. the coronavirus is expected to have a negative effect on our financial results for fiscal 2020. the full extent and duration are uncertain and could be material.
critical accounting policies and estimates the preparation of financial statements and related disclosures in conformity with u.s. generally accepted accounting principles ("gaap") requires us to make judgments, assumptions, and estimates that affect the reported amounts of assets, liabilities, revenue, costs of sales, operating expenses, and related disclosures. we consider the accounting polices described below to be our critical accounting policies. these critical accounting policies are impacted significantly by judgments, assumptions, and estimates used in the preparation of the consolidated financial statements, and actual results could differ materially from the amounts reported based on these policies. our accounting policies are more fully described in note 2 of our accompanying notes to consolidated financial statements included in part ii, item 8, "financial statements and supplementary data" of this annual report on form 10-k.
revenue recognition revenue is recognized upon transfer of control of promised products or services to customers in an amount that reflects the consideration that we expect to receive in exchange for those products or services. revenue is recognized net of allowance for returns and any taxes collected from customers. we enter into contracts that can include various combinations of products and services, which are generally capable of being distinct and accounted for as separate performance obligations; however, determining whether products or services are considered distinct performance obligations that should be accounted for separately versus together may sometimes require significant judgment.
judgment is required to determine stand-alone selling price ("ssp") for each distinct performance obligation. we use a range of amounts to estimate ssp when products and services are sold separately and determine whether there is a discount to be allocated based on the relative ssp of the various products and services.  in instances where ssp is not directly observable, we determine ssp using information that may include market conditions and other observable inputs.
income taxes we are a u.s. based multinational company operating in multiple u.s. and foreign jurisdictions. judgment is required in evaluating our uncertain tax positions and determining our provision for income taxes. we consider many factors when evaluating and estimating our tax positions and tax benefits, which may require periodic adjustments and may not accurately forecast actual tax audit outcomes. determining whether an uncertain tax position is effectively settled requires judgment. changes in recognition or measurement of our uncertain tax positions would result in the recognition of a tax benefit or an additional charge to the tax provision.
income taxes are accounted for under the liability method, whereby deferred tax assets or liability account balances are calculated at the balance sheet date using current tax laws and rates in effect for the year in which the differences are expected to affect taxable income. a valuation allowance is recorded to reduce the carrying amounts of deferred tax assets if we believe it is more likely than not such assets will not be realized.
we are subject to the periodic examination of our domestic and foreign tax returns by the irs, state, local, and foreign tax authorities who may challenge our tax positions. we regularly assess the likelihood of adverse outcomes from these examinations in determining the adequacy of our provision for income taxes.
business combinations and valuation of goodwill and purchased intangible assets we allocate the fair value of purchase consideration to the assets acquired, liabilities assumed, and non-controlling interests in the acquiree based on their fair values at the acquisition date. the excess of the fair value of purchase consideration over the fair value of these assets acquired, liabilities assumed, and non-controlling interests in the acquiree is recorded as goodwill.
when determining the fair values of assets acquired, liabilities assumed, and non-controlling interests in the acquiree, management makes significant estimates and assumptions, especially with respect to intangible assets. critical estimates in valuing intangible assets include, but are not limited to, expected future cash flows, which includes consideration of future growth rates and margins, customer attrition rates, future changes in technology and brand awareness, loyalty and position, and discount rates. identifiable intangible assets are comprised of distribution channels and distribution rights, patents, licenses, technology, acquired backlog, trademarks, and in-process research and development.
we evaluate goodwill at the reporting unit level in the fourth quarter of each fiscal year or more frequently if indicators of potential impairment exist. we utilize either a qualitative assessment or a quantitative test to assess the likelihood of an impairment. in performing the qualitative assessment, we consider macroeconomic conditions, industry and market considerations, overall financial performance, and other relevant events and factors that may impact the reporting units. when we perform a quantitative test, the estimation of the fair value of a reporting unit involves the use of certain estimates and assumptions including expected future operating performance using risk-adjusted discount rates.
we amortize identifiable intangible assets over their estimated useful lives on a straight-line basis. changes in circumstances such as technological advances, changes to its business model, or changes in the capital strategy could result in a revised useful life. if the useful life of an asset is revised, the net book value of the estimated residual value is amortized over its revised remaining useful life. intangible assets are evaluated for impairment whenever events or changes in circumstances indicate that the carrying amount of those assets may not be recoverable based on their future cash flows. the estimated future cash flows are primarily based upon assumptions about expected future operating performance.
results of operations overview the following table is a summary of revenue, gross margin, and operating income for the periods indicated and should be read in conjunction with the narrative descriptions below.
fiscal years                                                       2019                  2018                  2017
(in millions)
revenue:
product                                                    $1,934.8              $1,999.9              $1,763.8
service                                                       686.2                 588.7                 475.4
subscription                                                  643.3                 519.8                 407.3
total revenue                                              $3,264.3              $3,108.4              $2,646.5
gross margin                                                1,780.9               1,681.0               1,377.6
gross margin %                                                 54.6   %              54.1   %              52.1   %
operating income                                              375.9                 320.7                 235.7
operating income as a % of revenue                             11.5   %              10.3   %               8.9   %
diluted earnings per share                                    $2.03                 $1.12                 $0.46
non-gaap revenue *                                         $3,271.3              $3,132.0              $2,649.3
non-gaap operating income *                                   667.8                 643.9                 471.5
non-gaap operating income as a % of non-gaap revenue*          20.4   %              20.6   %              17.8   %
non-gaap diluted earnings per share *                         $1.99                 $1.94                 $1.45
*see supplemental disclosure of non-gaap financial measures for a reconciliation of our gaap results to our non-gaap measures.
basis of presentation we have a 52-53 week fiscal year, ending on the friday nearest to december 31, which for fiscal 2019 was january 3, 2020. fiscal 2019 was a 53-week year, and 2018 and 2017 were 52-week years.
revenue in fiscal 2019, total revenue increased by $155.9 million, or 5%, to $3.26 billion from $3.11 billion in fiscal 2018. overall revenue increased due to organic growth in buildings and infrastructure and to a lesser extent, transportation and resources and utilities, partially offset by a decrease in geospatial. acquisitions, including viewpoint, contributed to growth, particularly in service and subscription revenue. we consider acquisition growth to include acquisition revenue that was not applicable in the prior corresponding periods.
by revenue category, overall product revenue decreased $65.1 million, or 3%, service revenue increased $97.5 million, or 17%, and subscription revenue increased $123.5 million, or 24%. product revenue decreased primarily due to ongoing weakness in our geospatial oem hardware sales and, to a lesser extent, resources and utilities agriculture oem sales. service and subscription revenue increased across all segments, with the biggest impact due to an increase in buildings and infrastructure due to the viewpoint acquisition as well as organic growth, and to a lesser extent, transportation, resources and utilities, and geospatial.
by segment, buildings and infrastructure revenue increased $170.5 million, or 16%, transportation increased $39.2 million, or 5%, resources and utilities revenue increased $3.3 million or 1%, and geospatial revenue decreased $73.7 million, or 10%, as compared to fiscal 2018. buildings and infrastructure revenue increased due to the viewpoint acquisition, which was acquired in the third quarter of fiscal 2018, and organic growth. transportation revenue increased due to increased organic growth and acquisition revenue. resources and utilities was up slightly due to organic and acquisition growth. geospatial revenue decreased mainly due to market softness.
during fiscal 2019, sales to customers in north america represented 55%, europe represented 28%, asia pacific represented 11%, and the rest of world represented 6% of our total revenue. we anticipate that sales to international customers will continue to account for a significant portion of our revenue.
no single customer accounted for 10% or more of our total revenue in fiscal 2019 or 2018. no single customer accounted for 10% or more of our accounts receivable as of fiscal years ended 2019 and 2018.
gross margin our gross margin varies due to a number of factors including product mix, pricing, distribution channel, production volumes, new product start-up costs, and foreign currency translations.
in fiscal 2019, our gross margin increased by $99.9 million as compared to fiscal 2018, primarily due to increased organic service and subscription revenue growth in buildings and infrastructure, as well as the viewpoint acquisition, partially offset by a decrease in geospatial due to revenue declines. gross margin as a percentage of total revenue was relatively flat at 54.6% in fiscal 2019 and 54.1% in fiscal 2018 due to buildings and infrastructure improved product mix, largely offset by geospatial revenue decline and transportation product mix and pricing pressures.
operating income operating income increased by $55.2 million for fiscal 2019 as compared to fiscal 2018. operating income as a percentage of total revenue for fiscal 2019 was 11.5% as compared to 10.3% for fiscal 2018. the increase in operating income was attributable to lower intangible asset amortization resulting from expiration of prior acquisitions' amortization and strong operating results in buildings and infrastructure. these increases were partially offset by geospatial revenue decline and transportation gross margin compression and increased research and development costs.
research and development, sales and marketing, and general and administrative expenses research and development (r&d), sales and marketing (s&m), and general and administrative (g&a) expense are summarized in the following table:
fiscal years                            2019                  2018                  2017
(in millions)
research and development          $469.7                $446.1                $370.2
percentage of revenue               14.4   %              14.4   %              14.0   %
sales and marketing                504.2                 479.8                 400.1
percentage of revenue               15.4   %              15.4   %              15.1   %
general and administrative         330.6                 349.8                 301.7
percentage of revenue               10.1   %              11.3   %              11.4   %
total                           $1,304.5              $1,275.7              $1,072.0
overall, r&d, sales and marketing, and g&a expenses increased by approximately $28.8 million in fiscal 2019 compared to fiscal 2018.
research and development expense increased by $23.6 million, or 5%, in fiscal 2019, as compared to fiscal 2018. overall, research and development spending was 14% of revenue in fiscal 2019 and 2018, respectively. as compared to the prior year, the increase in fiscal 2019 was primarily due to the impact of the viewpoint acquisition and, to a lesser extent, increased compensation expenses in transportation, partially offset by favorable foreign currency impacts.
we believe that the development and introduction of new products are critical to our future success, and we expect to continue active development of new products.
sales and marketing expense increased by $24.4 million, or 5%, in fiscal 2019, as compared to fiscal 2018. overall, spending for sales and marketing was 15% of revenue in fiscal 2019 and 2018, respectively. as compared to the prior year, the increase in fiscal 2019 was primarily due to the impact of the viewpoint acquisition and, to a lesser extent, an increase in compensation expense, partially offset by favorable foreign currency impacts.
general and administrative expense decreased by $19.2 million, or 5%, in fiscal 2019, as compared to fiscal 2018. overall, general and administrative spending was 10% and 11% of revenue in fiscal 2019 and 2018, respectively. as compared to the prior year, the decrease in fiscal 2019 was primarily due to lower compensation expense related to incentive compensation plans and, to a lesser extent, lower consulting costs and favorable foreign currency impacts, partially offset by the impact of the viewpoint acquisition.
amortization of purchased intangible assets fiscal years                  2019                2018                2017
(in millions)
cost of sales            $94.1              $103.2               $85.8
operating expenses        73.7                76.4                63.0
total                   $167.8              $179.6              $148.8
total amortization expense of purchased intangibles decreased $11.8 million as compared to fiscal 2018. the decrease was primarily due to the expiration of prior acquisitions' amortization.
non-operating income (expense), net the following table shows non-operating income (expense), net for the periods indicated and should be read in conjunction with the narrative descriptions below:
fiscal years                                          2019                2018                2017
(in millions)
interest expense, net                           $(82.4   )          $(73.2   )          $(25.2   )
income from equity method investments, net        35.8                28.7                29.5
other income, net                                 15.5                 1.8                 8.2
total non-operating income (expense), net       $(31.1   )          $(42.7   )           $12.5
total non-operating expense, net decreased by $11.6 million during fiscal 2019 compared with fiscal 2018. the decrease was due to increased joint venture profitability and a gain from the sale of an equity investment included in other income, net, partially offset by higher interest costs due to viewpoint acquisition debt being outstanding for a full year in fiscal 2019.
income tax provision the 2017 tax cuts and jobs act (the "tax act") reduced the u.s. federal tax rate from 35% to 21%, imposed a one-time transition tax on accumulated foreign earnings and created new taxes on certain foreign-sourced earnings referred to as global intangible low-taxed income ("gilti"). as a result, we recorded a provisional net income tax expense of $80.2 million in fiscal 2017. in fiscal 2018, we completed the accounting for the tax effects of the tax act and made immaterial adjustments to the provisional amounts recorded previously. additionally, in fiscal 2018, we finalized our accounting policy election to recognize deferred taxes in relation to gilti.
to align with our international business operations, in the fourth quarter of 2019, we completed a non-u.s. intercompany transfer of our intellectual property to a subsidiary in the netherlands.  the transaction resulted in deferred tax assets in the netherlands and gilti deferred tax liabilities in the u.s., recorded at the applicable statutory tax rates, resulting in a one-time income tax benefit of approximately $206.3 million.
our effective income tax rates for fiscal 2019 and 2018 were -49% and -2%, respectively. the fiscal 2019 rate was lower than the u.s. federal statutory rate of 21%, primarily due to a one-time tax benefit from a non-u.s. intercompany transfer of intellectual property, and benefits from reserve release due to expiration of the u.s. federal statute of limitations for certain tax years. the fiscal 2018 rate was lower than the u.s. federal statutory rate of 21%, primarily due to benefits from reserve release due to expiration of the u.s. federal statute of limitations for certain tax years, a one-time benefit from deferred taxes in relation to gilti, and benefits from stock based compensation.
results by segment we report our financial performance, including revenue and operating income, based on four reportable segments: buildings and infrastructure, geospatial, resources and utilities, and transportation.
our chief executive officer (chief operating decision maker) views and evaluates operations based on the results of our reportable operating segments under our management reporting system. these results are not necessarily in conformance with u.s. gaap. for additional discussion of our segments, see note 6 of the notes to the consolidated financial statements.
the following table is a breakdown of revenue and operating income by segment for the periods indicated and should be read in conjunction with the narrative descriptions below:
fiscal years                                                          2019                  2018                2017
(in millions)
buildings and infrastructure segment revenue                                               $1,258.2              $1,087.7              $830.5
segment revenue as a percent of total revenue                       38   %                35   %              31   %
segment operating income                                        $319.9                $256.7              $176.2
segment operating income as a percent of segment revenue          25.4   %              23.6   %            21.2   %
geospatial segment revenue                                                 $649.4                $723.1              $658.5
segment revenue as a percent of total revenue                       20   %                23   %              25   %
segment operating income                                        $132.2                $166.4              $129.4
segment operating income as a percent of segment revenue          20.4   %              23.0   %            19.7   %
resources and utilities segment revenue                                                 $571.4                $568.1              $482.0
segment revenue as a percent of total revenue                       18   %                18   %              18   %
segment operating income                                        $169.1                $168.2              $137.9
segment operating income as a percent of segment revenue          29.6   %              29.6   %            28.6   %
transportation segment revenue                                                 $792.3                $753.1              $678.3
segment revenue as a percent of total revenue                       24   %                24   %              26   %
segment operating income                                        $125.9                $143.3              $114.8
segment operating income as a percent of segment revenue          15.9   %              19.0   %            16.9   %
a reconciliation of our consolidated segment operating income to consolidated income before income taxes follows:
fiscal years                                                     2019                2018                2017
(in millions)
consolidated segment operating income                      $747.1              $734.6              $558.3
unallocated corporate expense                               (79.3   )           (90.7   )           (86.8   )
acquired deferred revenue adjustment                         (7.0   )           (23.6   )            (2.8   )
restructuring charges                                       (27.9   )            (8.7   )           (10.5   )
amortization of purchased intangible assets                (167.8   )          (179.6   )          (148.8   )
stock-based compensation                                    (75.0   )           (76.9   )           (64.8   )
amortization of acquisition-related inventory step-up           -                (0.2   )            (2.8   )
acquisition and divestiture items                           (20.5   )           (38.9   )            (7.4   )
amortization of acquired capitalized commissions              6.3                 4.7                 1.3
consolidated operating income                               375.9               320.7               235.7
non-operating income (expense), net                         (31.1   )           (42.7   )            12.5
consolidated income before taxes                           $344.8              $278.0              $248.2
buildings and infrastructure buildings and infrastructure revenue increased by $170.5 million, or 16%, and segment operating income increased by $63.2 million, or 25%, for fiscal 2019 as compared to fiscal 2018. revenue increased due to the impact of the viewpoint acquisition, as well as strong organic growth. building construction, including viewpoint, and civil engineering and construction experienced strong growth in service, primarily software maintenance, and subscription revenue. segment operating income and operating income percentage increased due to organic revenue growth, higher margin service and subscription product mix and improved operating expense control, and, to a lesser extent, the impact of the viewpoint acquisition.
geospatial geospatial revenue decreased by $73.7 million, or 10%, and segment operating income decreased by $34.2 million, or 21%, for fiscal year 2019 as compared to fiscal 2018. revenue decreased mainly due to continuing weakness in oem hardware sales, primarily china, and softness in geospatial survey sales. the hardware revenue decline was partially offset by stronger software sales, particularly in geospatial survey. segment operating income and operating income percentage decreased primarily due to the negative impact from the revenue shortfall.
resources and utilities resources and utilities revenue increased by $3.3 million, or 1%, and segment operating income increased by $0.9 million, or 1%, for fiscal year 2019 as compared to fiscal 2018. the revenue increased mainly due to growth in positioning services, utilities, and to a lesser extent acquisition revenue, partially offset by weakness in agriculture oem and reseller hardware sales, due to continued market uncertainties. segment operating income increased slightly due to revenue growth and improved gross margin due to increased software, service, and subscription product mix. operating income percentage was flat.
transportation transportation revenue increased by $39.2 million, or 5%, while segment operating income decreased by $17.4 million, or 12%, for fiscal 2019 as compared to fiscal 2018. revenue increased primarily due to subscription growth as customers convert from software licenses and hardware growth from transportation customers. segment operating income and operating income percentage decreased primarily due to gross margin compression resulting from hardware product mix, as well as pricing pressures, and increased research and development investments related to meeting demands of the electronic logging device regulatory mandate. we expect revenue and operating income impacts from these factors to continue into fiscal 2020, as we meet the demands of the electronic logging device regulatory mandate.
off-balance sheet arrangements other than inventory purchases and other commitments incurred in the normal course of business (see contractual obligations table below), we do not have any off-balance sheet financing arrangements or liabilities.
in the normal course of business to facilitate sales of our products, we indemnify other parties, including customers, lessors and parties to other transactions with us, with respect to certain matters. we may agree to hold the other party harmless against losses arising from a breach of representations or covenants, or out of intellectual property infringement or other claims made against certain parties. these agreements may limit the time within which an indemnification claim can be made and the amount of the claim. in connection with divesting some of our businesses or assets, we may also indemnify purchasers for certain matters in the normal course of business, such as breaches of representations, covenants or excluded liabilities. in addition, we entered into indemnification agreements with our officers and directors, and our bylaws contain similar indemnification obligations to our agents.
it is not possible to determine the maximum potential amount under these indemnification agreements due to the limited history of prior indemnification claims and the unique facts and circumstances involved in each particular agreement. historically, payments made by us under these agreements were not material and no liabilities have been recorded for these obligations on the consolidated balance sheets at the end of fiscal 2019 and 2018.
liquidity and capital resources at the end of fiscal year                                                 2019                  2018                2017
(in millions)
cash and cash equivalents and short-term investments                $189.2                $172.5              $537.4
as a percentage of total assets                                        3.0   %               3.0   %            12.5   %
principal balance of outstanding debt                             $1,854.0              $1,981.9              $918.2
fiscal years                                                              2019                  2018                2017
(in millions)
cash provided by operating activities                               $585.0                $486.7              $429.7
cash used in investing activities                                   (275.3   )          (1,649.6   )          (371.2   )
cash provided by (used in) financing activities                     (292.6   )             989.4                66.5
effect of exchange rate changes on cash and cash equivalents          (0.4   )             (12.5   )            17.4
net increase (decrease) in cash and cash equivalents                 $16.7               $(186.0   )          $142.4
cash and cash equivalents our ability to continue to generate cash from operations will depend in large part on profitability, the rate of collections of accounts receivable, our inventory turns, and our ability to manage other areas of working capital. our cash and cash equivalents are maintained with several financial institutions. deposits held with banks may exceed the amount of insurance provided on such deposits. generally, these deposits may be redeemed upon demand and are maintained with financial institutions considered to be of reputable credit and to present little credit risk. we believe that our cash and cash equivalents, and borrowings, as described below under the heading "debt", along with cash provided by operations, will be sufficient to meet our anticipated operating cash needs, debt service, stock repurchases under the stock repurchase program, and planned capital expenditures.
operating activities cash provided by operating activities was $585.0 million for fiscal 2019, as compared to $486.7 million for fiscal 2018. the increase of $98.3 million was primarily driven by an increase in net income, net of non-cash items, and favorable working capital requirements mainly resulting from an increase in deferred revenue associated with revenue growth, partially offset by a decrease in accrued compensation and benefits.
investing activities cash used in investing activities was $275.3 million for fiscal 2019, as compared to $1,649.6 million for fiscal 2018. the decrease of $1,374.3 million used in investing activities was primarily due to spending for business acquisitions during fiscal 2018, including the $1,212.1 million purchase of viewpoint and $485.5 million purchase of e-builder, partially offset by proceeds from the sale of short-term investments, also in fiscal 2018.
financing activities cash used in financing activities was $292.6 million for fiscal 2019, as compared to cash provided by financing activities of $989.4 million during fiscal 2018. the decrease of cash provided by financing activities of $1,282.0 million was primarily driven by the repayment of debt, net of borrowings, in fiscal 2019 as compared to the increase in debt proceeds, net of repayments, used to fund the viewpoint and e-builder acquisitions in fiscal 2018.
debt during fiscal 2019, we repaid $127.5 million of debt, net of borrowings. each of our debt agreements requires us to maintain compliance with certain debt covenants, all of which we were in compliance with at the end of fiscal 2019. refer to note 7 of the notes to consolidated financial statements for more information regarding our debt.
contractual obligations the following table summarizes our contractual obligations at the end of fiscal 2019:
payments due by period total           lessthan 1year             1-3years             3-5years             morethan5 years
(in millions)
principal payments on debt (1)                      $1,854.0                $219.0                 $225.0               $810.0                   $600.0
interest payments on debt (2)                          410.3                  74.1                  132.3                102.2                    101.7
operating leases (3)                                   212.7                  46.8                   63.7                 38.4                     63.8
other purchase obligations and commitments (4)         324.7                 236.3                   86.2                  2.2                        -
income taxes payable (5)                                72.7                   3.7                   14.5                 31.8                     22.7
total                                               $2,874.4                $579.9                 $521.7               $984.6                   $788.2
(1)   amount represents principal payments over the life of the debt obligations. for further information, see note 7 to the consolidated financial statements.
(2)   amount represents the expected interest payments relating to our debt, calculated using rates in effect as of the end of fiscal 2019. for further information, see note 7 to the consolidated financial statements.
(3)   operating leases represent undiscounted lease payments and include short-term leases and leases that were signed, but have not yet commenced as of the end of fiscal year 2019.
(4)   other purchase obligations and commitments primarily represent open non-cancelable purchase orders for material purchases with our vendors, and also include estimated payments due for acquisition related earn-outs.
(5)   income taxes payable represents a one-time transition tax liability related to known amounts of cash taxes payable in future years as a result of the tax act. for further information, see note 13 to the consolidated financial statements.
excluded from the table above are unrecognized tax benefits of $66.4 million included in other non-current liabilities, including interest and penalties.  at this time, we cannot make a reasonably reliable estimate of the period of cash settlement with tax authorities regarding this liability, and therefore, such amounts are not included in the contractual obligations table above.
effect of new accounting pronouncements the impact of recent accounting pronouncements is disclosed in note 2 of our accompanying notes to the consolidated financial statements included in part ii, item 8, "financial statements and supplementary data" of this annual report on form 10-k.
supplemental disclosure of non-gaap financial measures to supplement our consolidated financial information, we believe that the following information is helpful to an overall understanding of our past financial performance and prospects for the future. our non-gaap measures are not meant to be considered in isolation or as a substitute for comparable gaap measures. the non-gaap financial measures and detailed explanations to the adjustments to comparable gaap measures are below.
fiscal years
2019                                                                                     2018                                          2017
(in millions, except per share data)                 dollaramount        % ofrevenue               dollaramount        % ofrevenue               dollaramount        % ofrevenue revenue:
gaap revenue:                                     $3,264.3                                      $3,108.4                                      $2,646.5
acquired deferred revenue adjustment   ( a )           7.0                                          23.6                                           2.8
non-gaap revenue:                                 $3,271.3                                      $3,132.0                                      $2,649.3
gross margin:
gaap gross margin:                                $1,780.9                54.6   %              $1,681.0                54.1   %              $1,377.6                52.1   %
acquired deferred revenue adjustment   ( a )           7.0                                          23.6                                           2.8
restructuring charges                  ( b )           1.1                                           0.5                                           3.6
amortization of purchased intangible assets              ( c )          94.1                                          103.2                                           85.8
stock-based compensation                                 ( d )           5.6                                            4.5                                            3.9
amortization of acquisition-related inventory step-up    ( e )             -                                            0.2                                            2.8
acquisition / divestiture items                          ( f )             -                                            2.0                                              -
non-gaap gross margin:                                              $1,888.7               57.7         %          $1,815.0               58.0         %          $1,476.5               55.7         %
operating expenses:
gaap operating expenses:                                            $1,405.0               43.0         %          $1,360.3               43.8         %          $1,141.9               43.1         %
restructuring charges                                    ( b )         (26.8   )                                       (8.2   )                                       (6.9   )
amortization of purchased intangible assets              ( c )         (73.7   )                                      (76.4   )                                      (63.0   )
stock-based compensation                                 ( d )         (69.4   )                                      (72.4   )                                      (60.9   )
acquisition / divestiture items                          ( f )         (20.5   )                                      (36.9   )                                       (7.4   )
amortization of acquired capitalized commissions         ( g)            6.3                                            4.7                                            1.3
non-gaap operating expenses:                                        $1,220.9               37.3         %          $1,171.1               37.4         %          $1,005.0               37.9         %
operating income:
gaap operating income:                                                $375.9               11.5         %            $320.7               10.3         %            $235.7                8.9         %
acquired deferred revenue adjustment                     ( a )           7.0                                           23.6                                            2.8
restructuring charges                                    ( b )          27.9                                            8.7                                           10.5
amortization of purchased intangible assets              ( c )         167.8                                          179.6                                          148.8
stock-based compensation                                 ( d )          75.0                                           76.9                                           64.8
amortization of acquisition-related inventory step-up    ( e )             -                                            0.2                                            2.8
acquisition / divestiture items                          ( f )          20.5                                           38.9                                            7.4
amortization of acquired capitalized commissions         ( g)           (6.3   )                                       (4.7   )                                       (1.3   )
non-gaap operating income:                                            $667.8               20.4         %            $643.9               20.6         %            $471.5               17.8         %
non-operating income (expense), net:
gaap non-operating expense, net:                                      $(31.1   )                                     $(42.7   )                                      $12.5
acquisition / divestiture items                          ( f )         (12.1   )                                       (0.3   )                                       (0.3   )
debt issuance costs                                      ( h )             -                                            6.7                                              -
non-gaap non-operating expense, net:                                  $(43.2   )                                     $(36.3   )                                      $12.2
gaap and                                       gaap and                                       gaap and non-gaap                                       non-gaap                                       non-gaap tax rate % (n)                                 tax rate % (n)                                 tax rate % (n)
income tax provision (benefit):
gaap income tax provision (benefit):                                 $(169.7   )            (49        )%             $(5.3   )             (2        )%            $129.7                 52         %
non-gaap items tax effected                              ( i )          41.1                                           47.8                                           46.9
difference in gaap and non-gaap tax rate                 ( j )          30.1                                           27.3                                           14.8
tax reform impacts                                       ( k )             -                                           21.3                                          (80.2   )
reserve release upon statute of limitations expiration   ( l )         $14.0                                           24.3                                              -
ip restructuring impacts                                 ( m )        $206.3                                              -                                              -
non-gaap income tax provision:                                        $121.8                 20         %            $115.4                 19         %            $111.2                 23         %
net income:
gaap net income attributable to trimble inc.:                         $514.3                                         $282.8                                         $118.4
acquired deferred revenue adjustment                     ( a )           7.0                                           23.6                                            2.8
restructuring charges                                    ( b )          27.9                                            8.7                                           10.5
amortization of purchased intangible assets              ( c )         167.8                                          179.6                                          148.8
stock-based compensation                                 ( d )          75.0                                           76.9                                           64.8
amortization of acquisition-related inventory step-up                ( e )                   -                 0.2                 2.8
acquisition / divestiture items                                      ( f )                 8.4                38.6                 7.1
amortization of acquired capitalized commissions                     ( g )                (6.3   )            (4.7   )            (1.3   )
debt issuance costs                                                  ( h )                   -                 6.7                   -
non-gaap tax adjustments                                             ( i ) - ( m )      (291.5   )          (120.7   )            18.5
non-gaap net income attributable to trimble inc.                                        $502.6              $491.7              $372.4
diluted net income per share:
gaap diluted net income per share attributable to trimble inc.                           $2.03               $1.12               $0.46
acquired deferred revenue adjustment                                 ( a )                0.03                0.09                0.01
restructuring charges                                                ( b )                0.11                0.04                0.04
amortization of purchased intangible assets                          ( c )                0.66                0.71                0.58
stock-based compensation                                             ( d )                0.30                0.30                0.25
amortization of acquisition-related inventory step-up                ( e )                   -                   -                0.01
acquisition / divestiture items                                      ( f )                0.03                0.15                0.03
amortization of acquired capitalized commissions                     ( g )               (0.02   )           (0.02   )               -
debt issuance costs                                                  ( h )                   -                0.03                   -
non-gaap tax adjustments                                             ( i ) - ( m )       (1.15   )           (0.48   )            0.07
non-gaap diluted net income per share attributable to trimble inc.                       $1.99               $1.94               $1.45
adjusted ebitda:
operating income:
gaap operating income:                                                                  $375.9              $320.7              $235.7
acquired deferred revenue adjustment                                 ( a )                 7.0                23.6                 2.8
restructuring charges                                                ( b )                27.9                 8.7                10.5
amortization of purchased intangible assets                          ( c )               167.8               179.6               148.8
stock-based compensation                                             ( d )                75.0                76.9                64.8
amortization of acquisition-related inventory step-up                ( e )                   -                 0.2                 2.8
acquisition / divestiture items                                      ( f )                20.5                38.9                 7.4
amortization of acquired capitalized commissions                     ( g)                 (6.3   )            (4.7   )            (1.3   )
non-gaap operating income:                                                              $667.8              $643.9              $471.5
depreciation expense                                                 39.4                                     35.6                34.6
income from equity method investments, net                           35.8                                     28.7                29.5
adjusted ebitda                                                                         $743.0              $708.2              $535.6
non-gaap revenue and operating income results non-gaap revenue increased by $139.3 million or 4% as compared to fiscal 2018, due to the impact of viewpoint, which was acquired in the third quarter of fiscal 2018, and to a lesser extent organic growth in buildings and infrastructure and transportation and resources and utilities, partially offset by geospatial due to market softness.
non-gaap operating income increased by $23.9 million or 4% as compared to fiscal 2018, due to strong operating results in buildings and infrastructure, partially offset by geospatial and transportation. resources and utilities operating income was relatively flat.
non-gaap explanations non-gaap revenue we believe this measure helps investors understand the performance of our business, as non-gaap revenue excludes the effects of certain acquired deferred revenue that was written down to fair value in purchase accounting. management believes that excluding fair value purchase accounting adjustments more closely correlates with the ordinary and ongoing course of the acquired company's operations and facilitates analysis of revenue growth and business trends.
non-gaap gross margin we believe our investors benefit by understanding our non-gaap gross margin as a way of understanding how product mix, pricing decisions, and manufacturing costs influence our business. non-gaap gross margin excludes the effects of acquired deferred revenue that was written down to fair value in purchase accounting, restructuring charges, amortization of purchased intangible assets, stock-based compensation, amortization of acquisition-related inventory step-up, and acquisition/divestiture items associated with the acceleration of acquisition stock options from gaap gross margin. we believe that these adjustments offer investors additional information that may be useful to view trends in our gross margin performance.
non-gaap operating expenses we believe this measure is important to investors evaluating our non-gaap spending in relation to revenue. non-gaap operating expenses exclude restructuring charges, amortization of purchased intangible assets, stock-based compensation, and acquisition/divestiture items associated with external and incremental costs resulting directly from merger and acquisition activities such as: legal, due diligence, integration, and other costs including the acceleration of acquisition stock options, adjustment to the fair value of earn-out liabilities, and the effects of certain acquired capitalized commissions that were eliminated in purchase accounting from gaap operating expenses. we believe that these adjustments offer investors supplemental information to facilitate comparison of our operating expenses to our prior results.
non-gaap operating income we believe our investors benefit by understanding our non-gaap operating income trends, which are driven by revenue, gross margin, and spending. non-gaap operating income excludes the effects of purchase accounting adjustments to certain acquired deferred revenue and acquired capitalized commissions, restructuring charges, amortization of purchased intangible assets, stock-based compensation, amortization of acquisition-related inventory step-up, and acquisition/divestiture items from gaap operating income. we believe that these adjustments offer an alternative means for our investors to evaluate current operating performance compared to results of other periods.
non-gaap non-operating income (expense), net we believe this measure helps investors evaluate our non-operating income trends. non-gaap non-operating expense, net, excludes acquisition/divestiture gains/losses associated with unusual acquisition related items such as intangible asset impairment charges, gains or losses related to the acquisitions or sale of certain businesses and investments, and debt issuance costs. we believe that these exclusions provide investors with a supplemental view of our ongoing financial results.
non-gaap income tax provision we believe that providing investors with the non-gaap income tax provision is beneficial because it provides for consistent treatment of the excluded items in our non-gaap presentation.
non-gaap net income this measure provides a supplemental view of net income trends, that are driven by non-gaap income before taxes and our non-gaap tax rate. non-gaap net income excludes the effects of purchase accounting adjustments to certain acquired deferred revenue and acquired capitalized commissions, restructuring charges, amortization of purchased intangible assets, stock-based compensation, amortization of acquisition-related inventory step-up, acquisition/divestiture items, debt issuance costs, and non-gaap tax adjustments from gaap net income. we believe our investors benefit from understanding these adjustments and from an alternative view of our net income performance as compared to our past net income performance.
non-gaap diluted net income per share we believe our investors benefit by understanding our non-gaap operating performance as reflected in a per share calculation as a way of measuring non-gaap operating performance by ownership in the company. non-gaap diluted net income per share excludes the effects of purchase accounting adjustments to certain acquired deferred revenue and acquired capitalized commissions, restructuring charges, amortization of purchased intangible assets, stock-based compensation, amortization of acquisition-related inventory step-up, acquisition/divestiture items, debt issuance costs, and non-gaap tax adjustments from gaap diluted net income per share. we believe that these adjustments offer investors a useful view of our diluted net income per share as compared to our past diluted net income per share.
adjusted ebitda we believe that adjusted ebitda assists investors in comparing our performance over various reporting periods on a consistent basis. adjusted ebitda refers to non-gaap operating income plus depreciation and income from equity method investments.  we also believe the measure provides useful information to investors in understanding and evaluating our operating results in the same manner as our management and board of directors.
these non-gaap measures can be used to evaluate our historical and prospective financial performance, as well as our performance relative to competitors. we believe some of our investors track our "core operating performance" as a means of evaluating our performance in the ordinary, ongoing, and customary course of our operations. core operating performance excludes items that are non-cash, not expected to recur, or not reflective of ongoing financial results. management also believes that looking at our core operating performance provides a supplemental way to provide consistency in period-to-period comparisons. accordingly, management excludes from non-gaap those items relating to the effects of purchase accounting adjustments to certain acquired deferred revenue and acquired capitalized commissions, restructuring charges, amortization of purchased intangible assets, stock-based compensation, amortization of acquisition-related inventory step-up, acquisition/divestiture items, debt issuance costs, and non-gaap tax adjustments.
(a)   acquired deferred revenue adjustment. purchase accounting generally requires us to write-down acquired deferred revenue to fair value. our gaap revenue includes the fair value impact from purchase accounting for post-contract support and subscriptions contracts assumed in connection with our acquisitions. the non-gaap adjustment to our revenue is intended to reflect the full amount of such revenue. we believe this adjustment is useful to investors as a measure of the ongoing performance of our business and facilitates analysis of revenue growth and business trends.
(b)   restructuring charges. included in our gaap presentation of cost of sales and operating expenses, restructuring charges recorded are primarily for employee compensation resulting from reductions in employee headcount in connection with our company restructurings. we exclude restructuring charges from our non-gaap measures because we believe they do not reflect expected future operating expenses, they are not indicative of our core operating performance, and they are not meaningful in comparisons to our past operating performance. we have incurred restructuring expense in each of the periods presented. however, the amount incurred can vary significantly based on whether a restructuring has occurred in the period and the timing of headcount reductions.
(c)   amortization of purchased intangible assets. included in our gaap presentation of gross margin and operating expenses is amortization of purchased intangible assets. u.s. gaap accounting requires that intangible assets are recorded at fair value and amortized over their useful lives. consequently, the timing and size of our acquisitions will cause our operating results to vary from period to period, making a comparison to past performance difficult for investors. this accounting treatment may cause differences when comparing our results to companies that grow internally because the fair value assigned to the intangible assets acquired through acquisition may significantly exceed the equivalent expenses that a company may incur for similar efforts when performed internally. furthermore, the useful life that we use to amortize our intangible assets over may be substantially different from the time period that an internal growth company incurs and recognizes such expenses. we believe that by excluding the amortization of purchased intangible assets, which primarily represents technology and/or customer relationships already developed, this provides an alternative way for investors to compare our operations pre-acquisition to those post-acquisition and to those of our competitors that have pursued internal growth strategies. however, we note that companies that grow internally will incur costs to develop intangible assets that will be expensed in the period incurred, which may make a direct comparison more difficult.
(d)   stock-based compensation. included in our gaap presentation of cost of sales and operating expenses, stock-based compensation consists of expenses for employee stock options and awards and purchase rights under our employee stock purchase plan. we exclude stock-based compensation expense from our non-gaap measures because some investors may view it as not reflective of our core operating performance as it is a non-cash expense. for fiscal years 2019, 2018 and 2017, stock-based compensation was allocated as follows:
fiscal years
(in millions)                                   2019              2018              2017
cost of sales                               $5.6              $4.5              $3.9
research and development                    16.7              15.0              10.4
sales and marketing                         13.0              10.0               9.3
general and administrative                  39.7              47.4              41.2
total stock-based compensation expense     $75.0             $76.9             $64.8
(e)   amortization of acquisition-related inventory step-up. the purchase accounting entries associated with our business acquisitions require us to record inventory at its fair value, which is sometimes greater than the previous book value of the inventory. included in our gaap presentation, the increase in inventory value is amortized to cost of sales over the period that the related product is sold. we exclude inventory step-up amortization from our non-gaap measures because it is a non-cash expense that we do not believe is indicative of our ongoing operating results. we further believe that excluding this item from our non-gaap results is useful to investors in that it allows for period-over-period comparability.
(f)   acquisition/divestiture items. included in our gaap presentation of cost of sales and operating expenses, acquisition costs consist of external and incremental costs resulting directly from merger and acquisition and strategic investment activities such as legal, due diligence, integration, and other closing costs including the acceleration of acquisition stock options and adjustments to the fair value of earn-out liabilities. included in our gaap presentation of non-operating expense, net, acquisition/divestiture items include unusual acquisition, investment, and/or divestiture gains/losses. although we do numerous acquisitions, the costs that have been excluded from the non-gaap measures are costs specific to particular acquisitions. these are one-time costs that vary significantly in amount and timing and are not indicative of our core operating performance.
(g)   amortization of acquired capitalized commissions. purchase accounting generally requires us to eliminate capitalized sales commissions balances as of the acquisition date. our gaap sales and marketing expenses generally do not reflect the amortization of these capitalized sales commissions balances. the non-gaap adjustment to increase our sales and marketing expenses is intended to reflect the full amount of amortization related to such balances as though the acquired companies operated independently in the periods presented. we believe this adjustment to sales and marketing expenses is useful to investors as a measure of the ongoing performance of our business.
(h)   debt issuance costs. included in our non-operating expense, net this amount represents incurred costs in connection with a bridge facility we put in place for the viewpoint acquisition, costs associated with the issuance of new credit facilities and our senior notes issued in 2018 that were not capitalized as debt issuance costs, and a write-off of debt issuance costs for terminated and/or modified credit facilities. we excluded the debt issuance cost write-off from our non-gaap measures. we believe that investors benefit from excluding this item from our non-operating income to facilitate an evaluation of our non-operating income trends.
(i)   non-gaap items tax effected. this amount adjusts the provision for income taxes to reflect the effect of the non-gaap items (a) - (h) on non-gaap net income. we believe this information is useful to investors because it provides for consistent treatment of the excluded items in this non-gaap presentation.
(j)   difference in gaap and non-gaap tax rate. this amount represents the difference between the gaap and non-gaap tax rates applied to the non-gaap operating income plus the non-gaap non-operating expense, net. we believe that investors benefit from excluding this amount from our non-gaap income tax provision because it facilitates a comparison of the non-gaap tax provision in the current and prior periods.
(k)   tax reform impacts. this amount represents the provision for income taxes recorded as a result of the tax act enacted in december 22, 2017. the provision primarily includes a one-time tax benefit from the policy election to establish deferred taxes in relation to gilti as created by the tax act. we excluded this item as it is a non-recurring expense. we believe that investors benefit from excluding this item from our non-gaap income tax provision because it allows for period-over-period comparability.
(l)   reserve release upon statute of limitations expiration. this amount represents a one time tax benefit resulting from a reserve release due to the expiration of statute of limitations for certain years. we excluded this because it is non-recurring and is not indicative of our core operating performance.
(m)   ip restructuring impacts. these amounts represent net deferred tax impacts resulting from a non-u.s. intercompany transfer of intellectual property, consistent with changes in tax laws and our international business operations. we excluded this because it is not indicative of our core operating performance.
(n)   gaap and non-gaap tax rate percentages. these percentages are defined as gaap income tax provision as a percentage of gaap income before taxes and non-gaap income tax provision as a percentage of non-gaap income before taxes. we believe that investors benefit from a presentation of non-gaap tax rate percentage as a way of facilitating a comparison to non-gaap tax rates in prior periods.
