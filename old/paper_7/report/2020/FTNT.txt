item 7. management's discussion and analysis of financial condition and results of operations in addition to historical information, this annual report on form 10-k contains forward-looking statements within the meaning of section 27a of the securities act and section 21e of the exchange act. these statements include, among other things, statements concerning our expectations regarding:
•the duration and impact of the covid-19 pandemic;
•continued growth and market share gains;
•variability in sales in certain product categories from year to year and between quarters;
•expected impact of sales of certain products and services;
•the impact of macro-economic, geopolitical factors and other disruption on our manufacturing or sales, including the impact of the covid-19 pandemic and other public health issues and natural disasters;
•the proportion of our revenue that consists of our product and service revenue, and the mix of billings between products and services, and the duration of service contracts;
•the impact of our product innovation strategy;
•the effects of government regulation, tariffs and other related policies;
•drivers of long-term growth and operating leverage, such as sales productivity, functionality and value in our standalone and bundled subscription service offerings;
•growing our sales to businesses, service providers and government organizations, our ability to execute these sales and of the complexity of selling to all segments (including the increased competition and unpredictability of timing associated with sales to larger enterprises), the impact of sales to these organizations on our long-term growth, expansion and operating results, and the effectiveness of our internal sales organization;
•our ability to hire properly qualified and effective sales, support and engineering employees;
•trends in revenue, cost of revenue and gross margin;
•trends in our operating expenses, including sales and marketing expense, research and development expense, general and administrative expense, and expectations regarding these expenses;
•risks and expectations related to acquisitions, including integration issues related to product plans and products, including the acquired technology;
•expectations that our operating expense will increase in absolute dollars during 2021;
•expectations that proceeds from the exercise of stock options in future years will be adversely impacted by the increased mix of restricted stock units versus stock options granted;
•estimates of a range of 2021 spending on our headquarters expansion project and of the anticipated completion timeline for the project;
•expectations regarding uncertain tax benefits and our effective domestic and global tax rates, and the impact of the tax cuts and jobs act (the "2017 tax act") and the coronavirus aid, relief, and economic security act (the "cares act");
•expectations regarding spending related to real estate and other capital expenditures and to the impact on free cash flows;
•competition in our markets;
•statements regarding expected outcomes and liabilities in litigation;
•our intentions regarding share repurchases and the sufficiency of our existing cash, cash equivalents and investments to meet our cash needs for at least the next 12 months;
•other statements regarding our future operations, financial condition and prospects and business strategies; and
•adoption and impact of new accounting standards.
these forward-looking statements are subject to certain risks and uncertainties that could cause our actual results to differ materially from those reflected in the forward-looking statements. factors that could cause or contribute to such differences include, but are not limited to, those discussed in this annual report on form 10-k and, in particular, the risks discussed under the heading "risk factors" in part i, item 1a of this annual report on form 10-k and those discussed in other documents we file with the sec. we undertake no obligation, and specifically disclaim any obligation, to revise or publicly release the results of any revision to these and any other forward-looking statements. given these risks and uncertainties, readers are cautioned not to place undue reliance on such forward-looking statements.
business overview fortinet is a global leader in cybersecurity solutions provided to a wide variety of organizations, including enterprises, communication service providers, government organizations and small businesses. our cybersecurity solutions are designed to provide broad visibility and segmentation of the digital attack surface through our integrated fortinet security fabric platform, which features automated protection, detection and response.
the focus areas of our business consist of:
•security-driven networking-we derive a majority of product sales from our fortigate network security appliances. our fortigate network security appliances include a broad set of built-in security and networking features and functionalities, including firewall, next-generation firewall, secure web gateway, secure sockets layer ("ssl") inspection, software-defined wide area network ("sd-wan"), intrusion prevention system("ips"), sandboxing, data leak prevention, virtual private network ("vpn"), switch and wireless controller and wide area network ("wan") edge. our network security appliances are managed by our fortios network operating system, which provides the foundation for fortigate security functions. we enhance the performance of our network security appliances from branch to data center by designing and implementing security processing units ("spus") technology within our appliances, enabling us to add security and network functionality with minimal impact to network throughput performance.
•infrastructure security-the fortinet security fabric platform extends beyond the network to cover other attack vectors. other infrastructure solutions covered include teleworker and remote security solutions such as fortiauthenticator, forticlient and fortitoken, as well as secure access (wi-fi and switch).
•dynamic cloud security-we help customers connect securely to and across their individual, hybrid and multi-cloud environments by offering security through our virtual firewall and other software products and through integrated capabilities with major cloud platforms. our public and private cloud security solutions, including virtual appliances and hosted solutions, extend the core capabilities of the fortinet security fabric platform in and across cloud environments, delivering security that follows their applications and data. our secure sd-wan for multi-cloud solution automates deployment of an overlay network across different cloud networks and offers visibility, control and centralized management that integrates functionality across multiple cloud environments. our cloud security portfolio also includes securing applications, including email and web. fortinet cloud security offerings are available for deployment in major public and private cloud environments, including amazon web services, microsoft azure, google cloud, oracle cloud, alibaba cloud, ibm cloud and vmware cloud. we also offer managed ips and web application firewall ("waf") rules delivered by fortiguard labs as an overlay service to native security offerings offered by amazon web services.
•endpoint protection, internet of things ("iot") and operational technology ("ot") security-we protect end-customers from advanced threats that target their devices and the data that reside on them through our advanced endpoint solutions that provide core endpoint protection, advanced threat protection, incident monitoring, and response. additionally, the proliferation of iot and ot devices has generated new opportunities for us to grow our business. we offer network access control solutions that provide visibility, control and automated event responses in order to secure iot devices.
•ai-driven security operations-we develop and provide artificial intelligence ("ai") driven security operations solutions, including fortiguard and other security subscription services, endpoint detection and response, and our security orchestration, automation and response ("soar") capabilities and solutions, that can be applied across the entire fortinet security fabric platform. these solutions deliver intelligence and insights.
in addition to our security solutions, our customers may purchase fortiguard and other security subscription services to receive threat intelligence updates and protection updates delivered by fortiguard labs, forticare technical support services and the support of tams, res and professional service consultants for implementations or training services.
correction of prior period financial data as discussed further in note 2 of the notes to consolidated financial statements included in part ii, item 8 of this annual report on form 10-k, we identified an immaterial error related to the commencement of revenue recognition for certain forticare support service contracts, which resulted in an understatement of revenue during the years ended 2019 and 2018, respectively.
the correction of this error resulted in increases to service revenue, gross profit and operating income of $6.8 million and $3.4 million for the year ended 2019 and 2018, respectively. net income increased by $5.2 million and $2.7 million for the year ended 2019 and 2018, respectively. this resulted in an increase to diluted net income per share of $0.03 and $0.01 for the year ended 2019 and 2018, respectively.
we evaluated the effect of this correction on the previous results of operations and determined that it did not materially impact any trends previously disclosed. this correction did not impact net cash provided by operating activities, billings or free cash flows.
financial highlights
•total revenue was $2.59 billion in 2020, an increase of 20% compared to $2.16 billion in 2019. product revenue was $916.4 million in 2020, an increase of 16% compared to $788.5 million in 2019. service revenue was $1.68 billion in 2020, an increase of 22% compared to $1.37 billion in 2019.
•total gross profit was $2.02 billion in 2020, an increase of 22% compared to $1.66 billion in 2019.
•we generated operating income of $531.8 million in 2020, an increase of 52% compared to $351.0 million in 2019. operating income for 2020 included gains on an ip matter of $40.2 million.
•cash, cash equivalents and investments were $1.96 billion as of december 31, 2020, a decrease of $254.3 million, or 12%, from december 31, 2019.
•in 2020, we repurchased 11.7 million shares of common stock under the repurchase program for an aggregate purchase price of $1.08 billion. in 2019, we repurchased 1.9 million shares of common stock for a total purchase price of $140.9 million.
•deferred revenue was $2.61 billion as of december 31, 2020, an increase of $496.2 million, or 24%, from december 31, 2019. short-term deferred revenue was $1.39 billion as of december 31, 2020, an increase of $237.0 million, or 21%, from december 31, 2019.
•we generated cash flows from operating activities of $1.08 billion in 2020, an increase of $275.7 million, or 34%, compared to 2019.
our revenue growth was driven by both product and service revenue. on a geographic basis, revenue continues to be diversified globally, which remains a key strength of our business. in 2020, the americas region, the europe, middle east and africa ("emea") region and the asia pacific ("apac") region contributed 42%, 38% and 20% of our total revenue, respectively, and increased by 17%, 21% and 23% compared to 2019, respectively.
product revenue grew 16% in 2020. we experienced revenue growth across several of our hardware and software products, including sd-wan and teleworker and remote security solutions. service revenue growth of 22% in 2020 was driven by the strength of our fortiguard and other security subscription revenue and fortigate technical support and other service revenue, which both grew 22% in 2020.
our billings were diversified on a geographic basis. in 2020, approximately 50% of our billings in the aggregate were from over 80 countries that individually contributed less than 3% of our billings.
during the fourth quarter of 2020, we acquired panopta holdings llc (" panopta") to provide a platform for monitoring the health and performance of network and it infrastructure. during the third quarter of 2020, we acquired opaq networks, inc. ("opaq") to further enhance the fortinet security fabric platform by providing enterprises with the zero trust network access sase cloud solution. the impact of these acquisitions were not material to our consolidated financial statements.
in 2020, we recognized gains of $40.2 million on an ip matter in connection with a mutual covenant-no-to-sue and release agreement with a competitor in the network security industry. excluding the gains on the ip matter, operating expenses as a percentage of revenue decreased by 1.3 percentage points compared to 2019. headcount increased by 16% to 8,238 employees and contractors as of december 31, 2020, up from 7,082 as of december 31, 2019.
covid-19 update the united states and the global community we serve are facing unprecedented challenges posed by the covid-19 pandemic. in response to the pandemic, we have taken a number of actions to protect our employees, including restricting travel and directing most of our employees to work from home. where onsite work is permitted, we have implemented measures such as staggered work shifts, social distancing, the use of face coverings, health safety awareness training and frequent disinfection of shared spaces. we have implemented our readiness plans, which include steps to maintain critical internet infrastructure with many employees working remotely.
we are also providing free online information technology security training for the public, aimed at helping high school and college students and professionals augment their security skill sets to open career opportunities and to help narrow the security skills gap. as of december 31, 2020, there have been over 800,000 registrations for our free online trainings since we launched the program. we will continue to provide free online trainings in 2021.
while the broader implications of the covid-19 pandemic on our employees and overall financial performance remain uncertain, we have seen certain impacts on our business and operations, results of operations, financial condition, cash flows, liquidity and capital and financial resources as of and during the year ended december 31, 2020. conversely, some aspects of our business do not appear to have been significantly affected. during the year ended december 31, 2020, we have observed the following:
•in most countries, our employees ability to travel was reduced. in-person sales and marketing events or meetings that would normally have been held were canceled, postponed or converted into virtual events. as a result, expenses related to travel and marketing events decreased significantly. to the extent that it becomes safe for our employees to travel and for us to hold or attend marketing events, these expenses may increase in the future, although we cannot predict if or when such expenses will increase or return to pre-pandemic levels.
•after performing additional credit review of our existing customers, including obtained credit reports and reviewing their latest available statements of financial position, we increased the allowance of credit losses for certain accounts receivable. the allowance for credit losses was $2.5 million as of december 31, 2020. provisions, write-offs and recoveries were not material during the year ended december 31, 2020.
•we have offered payment terms in excess of our contractual agreements to certain distributor customers, which has resulted in an increase to the average collection period of our trade receivables. as of december 31, 2020, 97% of our outstanding trade accounts receivable was due to be collected during the first quarter of 2021.
•the countries and geographic regions in which we experienced the fastest billings growth in the fourth quarter of 2020, as compared to the fourth quarter of 2019, were countries and geographic regions in which the covid-19 pandemic is generally considered to have had a comparatively shorter or less severe impact on the local population and economy during the quarter.
•we have noted that, for some of our customers, sales cycles appear to have lengthened, though it is unclear whether this trend will persist.
•our average service contract duration increased by approximately two months in the fourth quarter of 2020 as compared to the fourth quarter of 2019.
•in order to mitigate supply chain risk and in anticipation of fourth-quarter demand, we have increased our on-hand stock of certain products.
•the yield on investment-grade debt has decreased, and while the risk of credit losses on our investments and cash equivalents has not changed significantly, as the debt securities in our portfolio have matured, they have been replaced by securities with lower effective interest rates. this has contributed to a decrease in our interest income during the year ended december 31, 2020, compared to the same periods last year.
•in accordance with the cares act, we have deferred the deposit and payment of our employer's share of social security taxes. this did not materially affect net cash provided by operating activities during the period.
through the filing of this annual report on form 10-k, there have been no material changes to the trends described above. going forward, however, the situation is uncertain, rapidly changing and hard to predict, and the covid-19 pandemic may have a material negative impact on our future periods. if we experience significant changes in our billings growth rates, it will impact product revenue in the current quarter and fortiguard and forticare service revenues in subsequent quarters, as we sell annual and multi-year service contracts that are recognized ratably over the contractual service term. in addition, the broader implications of the pandemic on our business and operations and our financial results, including the extent to which the effects of the pandemic will impact future results and growth in the cybersecurity industry, remain uncertain. the duration and severity of the economic downturn from the pandemic may negatively impact our business and operations, results of operations, financial condition, cash flows, liquidity and capital and financial resources in a material way. as a result, the effects of the pandemic may not be fully reflected in our results of operations until future periods. for further discussion, see part i, item 1a of this annual report on form 10-k.
business model we typically sell our security solutions to distributors that sell to networking security focused resellers and to service providers and managed security service providers ("mssps"), who, in turn, sell to end-customers. at times, we also sell directly to large service providers and major systems integrators who may sell to our end-customers or use our products and services to provided hosted solutions to other enterprises. our end-customers are located in over 80 countries and include small, medium and large enterprises and government organizations across a wide range of industries, including telecommunications, government, financial services, retail, technology, education, manufacturing and healthcare. an end-customer deployment may involve as few as one or as many as thousands of appliances and other fortinet security fabric platform products, depending on the end-customer's size and security requirements.
we also offer our products through major cloud providers, and have recognized revenue on a usage basis from amazon web services, microsoft azure, google cloud, oracle cloud, alibaba cloud and ibm cloud. we have also recognized revenue from customers who deploy our products in a bring-your-own-license ("byol") arrangement in private clouds or at cloud providers. in a byol arrangement, a customer purchases a software license from us through our channel partners and deploys the software in a cloud provider's environment. similarly, customers may purchase such a license from us and deploy in third-party clouds or in their private cloud.
our customers purchase our hardware products and software licenses, as well as our fortiguard and other security subscription and forticare technical support services. we generally invoice at the time of our sale for the total price of the products and security and technical support services. standard payment terms are generally no more than 60 days, though, as noted in the covid-19 update above, we have recently offered extended payment terms to certain distributor customers.
key metrics we monitor a number of key metrics, including the key financial metrics set forth below, in order to help us evaluate growth trends, establish budgets, measure the effectiveness of our sales and marketing efforts, and assess operational efficiencies. the following table summarizes revenue, deferred revenue, billings (non-gaap), net cash provided by operating activities, and free cash flow (non-gaap). we discuss revenue below under "-components of operating results," and we discuss net cash provided by operating activities below under "-liquidity and capital resources." deferred revenue, billings (non-gaap), and free cash flow (non-gaap) are discussed immediately below the following table.
year ended or as of december 31,
2020                                                               2019                              2018
(in millions)
revenue                                            $2,594.4                          $2,163.0                          $1,804.6
deferred revenue                                   $2,605.3                          $2,109.1                          $1,666.8
billings (non-gaap)                                $3,090.0                          $2,602.9                          $2,153.3
net cash provided by operating activities          $1,083.7                            $808.0                            $638.9
free cash flow (non-gaap)                            $907.8                            $715.8                            $585.9
deferred revenue. our deferred revenue consists of amounts that have been invoiced but that have not yet been recognized as revenue. the majority of our deferred revenue balance consists of the unrecognized portion of service revenue from fortiguard and other security subscription and forticare technical support service contracts, which is recognized as revenue ratably over the contractual service period. we monitor our deferred revenue balance, deferred revenue growth and the mix of short-term and long-term deferred revenue because deferred revenue represents a significant portion of free cash flow and of revenue to be recognized in future periods. deferred revenue was $2.61 billion as of december 31, 2020, an increase of $496.2 million, or 24%, from december 31, 2019.
billings (non-gaap). we define billings as revenue recognized in accordance with generally accepted accounting principles in the united states ("gaap") plus the change in deferred revenue from the beginning to the end of the period and adjustments to the deferred revenue balance due to adoption of financial accounting standards board ("fasb") topic 606, revenue from contracts with customers ("topic 606"), less any deferred revenue balances acquired from business combination(s) during the period. we consider billings to be a useful metric for management and investors because billings drive current and future revenue, which is an important indicator of the health and viability of our business. there are a number of limitations related to the use of billings instead of gaap revenue. first, billings include amounts that have not yet been recognized as revenue and are impacted by the term of security and support agreements. second, we may calculate billings in a manner that is different from peer companies that report similar financial measures. management accounts for these limitations by providing specific information regarding gaap revenue and evaluating billings together with gaap revenue. total billings were $3.09 billion for 2020, an increase of 19% compared to $2.60 billion in 2019.
a reconciliation of revenue, the most directly comparable financial measure calculated and presented in accordance with gaap, to billings is provided below:
year ended december 31,
2020                                                                                           2019                          2018
(in millions)
billings:
revenue                                                                    $2,594.4                      $2,163.0                      $1,804.6
add: change in deferred revenue                                               496.2       442.3                                           347.1
add: deferred revenue adjustment due to adoption of topic 606                     -                             -                           4.1
less: deferred revenue balance acquired in business combinations              (0.6)                         (2.4)                         (2.5)
total billings (non-gaap)                                                  $3,090.0                      $2,602.9                      $2,153.3
free cash flow (non-gaap). we define free cash flow as net cash provided by operating activities minus purchases of property and equipment and excluding any significant nonrecurring items. we believe free cash flow to be a liquidity measure that provides useful information to management and investors about the amount of cash generated by the business that, after capital expenditures, can be used for strategic opportunities, including repurchasing outstanding common stock, investing in our business, making strategic acquisitions and strengthening the balance sheet. a limitation of using free cash flow rather than the gaap measures of cash provided by or used in operating activities, investing activities, and financing activities is that free cash flow does not represent the total increase or decrease in the cash and cash equivalents balance for the period because it excludes cash flows from investing activities other than capital expenditures and cash flows from financing activities. management accounts for this limitation by providing information about our capital expenditures and other investing and financing activities on the face of the consolidated statements of cash flows and under "-liquidity and capital resources" and by presenting cash flows from investing and financing activities in our reconciliation of free cash flow. in addition, it is important to note that other companies, including companies in our industry, may not use free cash flow, may calculate free cash flow in a different manner than we do or may use other financial measures to evaluate their performance, all of which could reduce the usefulness of free cash flow as a comparative measure. a reconciliation of net cash provided by operating activities, the most directly comparable financial measure calculated and presented in accordance with gaap, to free cash flow is provided below:
year ended december 31,
2020                                                                              2019   2018
(in millions)
free cash flow:
net cash provided by operating activities                     $1,083.7                   $808.0                        $638.9
less: purchases of property and equipment                      (125.9)                   (92.2)                        (53.0)
less: proceeds from intellectual property matter                (50.0)                   -                             -
free cash flow (non-gaap)                                       $907.8                   $715.8                        $585.9
net cash used in investing activities                          $(72.8)                   $(502.3)                      $(134.9)
net cash used in financing activities                       $(1,171.6)                   $(195.6)                      $(202.6)
components of operating results revenue. we generate the majority of our revenue from sales of our hardware and software products and amortization of amounts included in deferred revenue related to previous sales of fortiguard security subscription and forticare technical support services. we also recognize revenue from cloud security solutions, professional services and training.
our total revenue is comprised of the following:
•product revenue. product revenue is primarily generated from sales of our physical and virtual machine appliances. while the majority of our product revenue continues to be generated by our fortigate product line, our fabric appliance and software products are growing faster. as a percentage of total revenue, our product revenue has varied from quarter-to-quarter.
•service revenue. service revenue is generated primarily from fortiguard security subscription services and forticare technical support services. we recognize revenue from fortiguard security subscription and forticare technical support services over the contractual service period. our typical contractual support and subscription term is one to three years and, to a lesser extent, five years. we also generate a small portion of our revenue from professional services and training services, for which we recognize revenue as the services are provided, and cloud-based services, for which we recognize revenue as the services are delivered or on a monthly usage basis. as a percentage of total revenue, we continue to expect service revenue to be higher than product revenue. our service revenue growth rate depends significantly on the growth of our customer base, the expansion of our service bundle offerings, the expansion and introduction of new service offerings, the attach rate of service contracts to new product sales, and the renewal of service contracts by our existing customers.
our total cost of revenue is comprised of the following:
•cost of product revenue. the majority of the cost of product revenue consists of third-party contract manufacturers' costs and the costs of materials used in production. our cost of product revenue also includes supplies, shipping costs, personnel costs associated with logistics and quality control, facility-related costs, excess and obsolete inventory costs, warranty costs and amortization of intangible assets. personnel costs include direct compensation and benefits.
•cost of service revenue. cost of service revenue is primarily comprised of salaries, benefits and bonuses, as well as stock-based compensation. cost of service revenue also includes third-party repair and contract fulfillment, data center and cloud hosting, supplies and facility-related costs.
gross margin. gross profit as a percentage of revenue, or gross margin, has been and will continue to be affected by a variety of factors, including the average sales price of our products, product costs, the mix of products sold and the mix of revenue between hardware products, software licenses and services and any excess inventory write-offs. service revenue and software licenses have had a positive effect on our total gross margin given the higher gross margins compared to hardware product gross margins. during 2020, product gross margin benefited from gains in average selling price, as well as lower direct and indirect product costs as a percentage of product revenue. it also benefited from product mix, software revenue growth and a stable product transition environment. service gross margin benefited from renewals and continued sales of services and subscriptions, growing faster than related expenses. overall gross margin in 2021 will be impacted by service and product revenue mix.
operating expenses. our operating expenses consist of research and development, sales and marketing and general and administrative expenses. personnel costs are the most significant component of operating expenses and consist primarily of salaries, benefits, bonuses, sales commission and stock-based compensation. we expect personnel costs to continue to increase in absolute dollars as we expand our workforce.
•research and development. research and development expense consists primarily of personnel costs. additional research and development expenses include asic and system prototypes and certification-related expenses, depreciation of property and equipment and facility-related expenses. the majority of our research and development is focused on both software development and the ongoing development of our hardware platform. we record all research and development expenses as incurred. as of december 31, 2020, approximately 90% of our research and development teams were located in canada, the united states and india.
•sales and marketing. sales and marketing expense is the largest component of our operating expenses and primarily consists of personnel costs. additional sales and marketing expenses include product marketing, public relations, field marketing and channel marketing programs (e.g. partner cooperative marketing arrangements), as well as travel, depreciation of property and equipment and facility-related expenses. we intend to hire additional personnel focused on sales and marketing and expand our sales and marketing efforts worldwide in order to capture market share.
•general and administrative. general and administrative expense consists of personnel costs, as well as professional fees, depreciation of property and equipment and software and facility-related expenses. general and administrative personnel include our executive, finance, human resources, information technology and legal organizations. our professional fees principally consist of outside legal, auditing, tax, information technology and other consulting costs.
•gain on intellectual property matter. gain on intellectual property matter consists of the amortization of the deferred component of an agreement with a competitor in the network security industry, whereby, the competitor party paid us a lump sum of $50.0 million for a seven-year mutual covenant-not-to-sue for patent claims.
interest income-net. interest income-net consists primarily of interest earned on our cash equivalents and investments. we have historically invested our cash in corporate debt securities, certificates of deposit and term deposits, commercial paper, money market funds, and u.s. government and agency securities.
other expense-net. other expense-net consists primarily of foreign exchange gains and losses related to foreign currency remeasurement, as well as the gain on the sale or the impairment charges of our investments in privately held companies.
provision for (benefit from) income taxes. we are subject to income taxes in the united states, as well as other tax jurisdictions or countries in which we conduct business. earnings from our non-u.s. activities are subject to income taxes in local countries and may be subject to u.s. income taxes. our effective tax rate differs from the u.s. statutory rate primarily due to foreign income subject to different tax rates than in the u.s., nondeductible stock-based compensation expense, federal research and development tax credit, state taxes, withholding taxes, excess tax benefits related to stock-based compensation expense and the tax impacts of the 2017 tax act, including the foreign-derived intangible income ("fdii") deduction.
critical accounting policies and estimates our discussion and analysis of our financial condition and results of operations are based upon our financial statements, which have been prepared in accordance with gaap. these principles require us to make estimates and judgments that affect the reported amounts of assets, liabilities, revenue, cost of revenue and expenses, and related disclosures. we base our estimates on historical experience and on various other assumptions that we believe to be reasonable under the circumstances. to the extent that there are material differences between these estimates and our actual results, our future financial statements will be affected.
we believe that, of the significant accounting policies described in note 1 to our consolidated financial statements included in part ii, item 8 of this annual report on form 10-k, the following accounting policies involve a greater degree of judgment and complexity. accordingly, we believe these are the most critical to fully understand and evaluate our financial condition and results of operations.
revenue recognition revenues are recognized when control of goods or services is transferred to our customers, in an amount that reflects the consideration we expect to be entitled to in exchange for those goods or services.
we determine revenue recognition through the following steps:
•identification of a contract or contracts with a customer;
•identification of the performance obligations in a contract, including evaluation of performance obligations as to being distinct goods or services in a contract;
•determination of a transaction price;
•allocation of a transaction price to the performance obligations in a contract; and
•recognition of revenue when, or as, we satisfy a performance obligation.
our sales contracts typically contain multiple deliverables, such as hardware, software license, security subscription, technical support services and other services, which are generally capable of being distinct and accounted for as separate performance obligations. our hardware and software licenses have significant standalone functionalities and capabilities. accordingly, the hardware and software licenses are distinct from the security subscription and technical support services, as a customer can benefit from the product without the services and the services are separately identifiable within a contract. we allocate a transaction price to each performance obligation based on relative standalone selling price. we establish standalone selling price using the prices charged for a deliverable when sold separately. if not observable through past transactions, we determine standalone selling price by considering multiple historical factors including, but not limited to, cost of products, gross margin objectives, pricing practices, geographies and the term of a service contract.
deferred contract costs and commission expense we defer contract costs that are recoverable and incremental to obtaining customer sales contracts. contract costs, which primarily consist of sales commissions, are amortized on a systematic basis that is consistent with the transfer to the customer of the goods or services to which the asset relates. costs for initial contracts that are not commensurate with renewal commissions are amortized on a straight-line basis over the period of benefit of five years. significant estimates, assumptions, and judgments in accounting for deferred contract costs include, but are not limited to, identification of contract costs, anticipated billings and the expected period of benefit.
valuation of inventory inventory is recorded at the lower of cost or net realizable value. cost is computed using the first-in, first-out method. in assessing the ultimate recoverability of inventory, we make estimates regarding future customer demand, the timing of new product introductions, economic trends and market conditions. if the actual product demand is significantly lower than forecasted, we could be required to record inventory write-downs which would be charged to cost of product revenue. any write-downs could have an adverse impact on our gross margins and profitability.
business combinations we include the results of operations of the businesses that we acquire as of the respective dates of acquisition. we allocate the fair value of the purchase price of our business acquisitions to the tangible and intangible assets acquired and liabilities assumed based on their estimated fair values. the excess of the purchase price over the fair values of these identifiable assets and liabilities is recorded as goodwill. we often continue to gather additional information throughout the measurement period, and if we make changes to the amounts recorded, such changes are recorded in the period in which they are identified.
contingent liabilities from time to time, we are involved in disputes, litigation and other legal actions. however, there are many uncertainties associated with any litigation, and these actions or other third-party claims against us may cause us to incur substantial settlement charges, which are inherently difficult to estimate and could adversely affect our results of operations. we review significant new claims and litigation for the probability of an adverse outcome. estimates can change as individual claims develop. the actual liability in any such matters may be materially different from our estimates, which could result in the need to adjust our liability and record additional expenses.
accounting for income taxes we record income taxes using the asset and liability method, which requires the recognition of deferred tax assets and liabilities for the expected future tax consequences of events that have been recognized in our financial statements or tax returns. in addition, deferred tax assets are recorded for the future benefit of utilizing net operating losses and research and development credit carryforwards. deferred tax assets and liabilities are measured using the currently enacted tax rates that apply to taxable income in effect for the years in which those tax assets and liabilities are expected to be realized or settled. valuation allowances are provided when necessary to reduce deferred tax assets to the amount expected to be realized.
we recognize tax benefits from an uncertain tax position only if it is more likely than not, based on the technical merits of the position that the tax position will be sustained on examination by the tax authorities. the tax benefits recognized in the financial statements from such positions are then measured based on the largest benefit that has a greater than 50% likelihood of being realized upon ultimate settlement.
effective january 1, 2018, the 2017 tax act reduced the federal corporate income tax rate from 35% to 21% and created a territorial tax system with a one-time transition tax on foreign earnings of u.s. subsidiaries not previously subject to u.s. income tax. our selection of an accounting policy for 2018 with respect to the global intangible low-taxed income ("gilti") tax rules was to treat gilti tax as a current period expense under the period cost method. for 2019 and 2020, we were not subject to gilti. we will continue to monitor and assess the impact of the 2017 tax act and ongoing guidance and accounting interpretations issued in response to the 2017 tax act.
as part of the process of preparing our consolidated financial statements, we are required to estimate our taxes in each of the jurisdictions in which we operate. we estimate actual current tax exposure together with assessing temporary differences resulting from differing treatment of items, such as accruals and allowances not currently deductible for tax purposes. these differences result in deferred tax assets, which are included in our consolidated balance sheets. in general, deferred tax assets represent future tax benefits to be received when certain expenses previously recognized in our consolidated statements of income become deductible expenses under applicable income tax laws, or loss or credit carryforwards are utilized.
in assessing the realizability of deferred tax assets, management considers whether it is more likely than not that some portion or all of the deferred tax assets will be realized. the ultimate realization of deferred tax assets is dependent upon the generation of future taxable income during the periods in which those temporary differences become deductible. we continue to assess the need for a valuation allowance on the deferred tax assets by evaluating both positive and negative evidence that may exist. any adjustment to the valuation allowance on deferred tax assets would be recorded in the consolidated statements of income for the period that the adjustment is determined to be required.
results of operations the following tables set forth our results of operations for the periods presented and as a percentage of our total revenue for those periods. the period-to-period comparison of financial results is not necessarily indicative of financial results to be achieved in future periods.
year ended december 31,
2020                                                                                 2019                        2018
(in millions)
consolidated statements of income data:
revenue:
product                                            $916.4                      $788.5                      $674.4
service                                           1,678.0                     1,374.5                     1,130.2
total revenue                                     2,594.4                     2,163.0                     1,804.6
cost of revenue:
product                                             352.4                       324.6                       291.0
service                                             217.6                       181.3                       159.4
total cost of revenue                               570.0                       505.9                       450.4
gross profit:
product                                             564.0                       463.9                       383.4
service                                           1,460.4                     1,193.2                       970.8
total gross profit                                2,024.4                     1,657.1                     1,354.2
operating expenses:
research and development                            341.4                       277.1                       244.5
sales and marketing                               1,071.9                       926.9                       782.3
general and administrative                          119.5                       102.1                        93.0
gain on intellectual property matter               (40.2)                           -                           -
total operating expenses                          1,492.6                     1,306.1                     1,119.8
operating income                                    531.8                       351.0                       234.4
interest income-net                                  17.7                        42.5                        26.5
other expense-net                                   (7.8)                       (7.5)                       (6.6)
income before income taxes                          541.7                       386.0                       254.3
provision for (benefit from) income taxes            53.2                        54.3                      (80.6)
net income                                         $488.5                      $331.7                      $334.9
year ended december 31,
2020                                                                                     2019                                            2018
(as percentage of revenue)
revenue:
product                                                    35       %                                      36       %                                      37       %
service                                                    65                                              64                                              63
total revenue                                             100                                             100                                             100
cost of revenue:
product                                                    14                                              15                                              16
service                                                     8                                               8                                               9
total cost of revenue                                      22                                              23                                              25
gross margin:
product                                                    62                                              59                                              57
service                                                    87                                              87                                              86
total gross margin                                         78                                              77                                              75
operating expenses:
research and development                                   13                                              13                                              14
sales and marketing                                        41                                              43                                              43
general and administrative                                  5                                               5                                               5
gain on intellectual property matter                      (2)                                               -                                               -
total operating expenses                                   58                                              60                                              62
operating margin                                           20                                              16                                              13
interest income-net                                         1                                               2                                               1
other expense-net                                           -                                               -                                               -
income before income taxes                                 21                                              18                                              14
provision for (benefit from) income taxes                   2                                               3                                             (4)
net income                                                 19       %                                      15       %                                      19       %
percentages have been rounded for presentation purposes and may differ from unrounded results.
discussion regarding our financial condition and results of operations for 2019 as compared to 2018 can be found in item 7 of our annual report on form 10-k for the fiscal year ended december 31, 2019, filed with the sec on february 26, 2020.
2020 and 2019
revenue year ended december 31,
2020                                                                                                                2019
amount                                                  % of                     amount                             % of                     change                       % change revenue                                                     revenue
(in millions, except percentages)
revenue:
product                            $916.4                         35   %                       $788.5                         36   %                     $127.9                       16   %
service                           1,678.0                         65                          1,374.5                         64                          303.5                       22
total revenue                    $2,594.4                        100   %                     $2,163.0                        100   %                     $431.4                       20   %
revenue by geography:
americas                         $1,077.2                         42   %                       $920.2                         42   %                     $157.0                       17   %
emea                                991.9                         38                            816.5                         38                          175.4                       21
apac                                525.3                         20                            426.3                         20                           99.0                       23
total revenue                    $2,594.4                        100   %                     $2,163.0                        100   %                     $431.4                       20   %
total revenue increased by $431.4 million, or 20%, in 2020 compared to 2019. we continued to experience diversification of revenue globally, and across both customer and industry segments. revenue from all regions grew, with emea contributing the largest portion of the increase on an absolute dollar basis and apac contributing the fastest growth on a percentage basis.
product revenue increased by $127.9 million, or 16%, in 2020 compared to 2019. we experienced revenue growth across many of our products due to an increase in product revenue from our fortigate sd-wan solutions, software licenses and our security fabric platform products.
service revenue increased by $303.5 million, or 22%, in 2020 compared to 2019. fortiguard security subscription, forticare technical support and other revenues increased by $167.9 million and $135.6 million, respectively, or 22% in 2020 compared to 2019. the increases were primarily due to the recognition of revenue from our growing deferred revenue balance related to fortiguard and other security subscriptions and forticare technical support, including our customers moving to higher-tier support offerings.
of the service revenue recognized in 2020, 68% was included in the deferred revenue balance as of december 31, 2019. of the service revenue recognized in 2019, 68% was included in the deferred revenue balance as of december 31, 2018.
cost of revenue and gross margin year ended december 31,
2020                                                   2019                          change                     % change
(in millions, except percentages)
cost of revenue:
product                          $352.4                          $324.6                         $27.8                        9   %
service                           217.6                           181.3                          36.3                       20
total cost of revenue            $570.0                          $505.9                         $64.1                       13   %
gross margin (%):
product                            61.5    %                       58.8    %
service                            87.0    %                       86.8    %
total gross margin                 78.0    %                       76.6    %
total gross margin increased by 1.4 percentage points in 2020 compared to 2019, driven primarily by improvements to product gross margins.
product gross margin increased by 2.7 percentage points in 2020 compared to 2019. product gross margin benefited from lower direct costs of hardware as a percentage of product revenue and increased software sales. cost of product revenue was comprised primarily of third-party contract manufacturers' costs and the costs of materials used in production.
service gross margin increased by 0.2 percentage points in 2020 compared to 2019, as our personnel costs grew slower than our service revenue and we experienced lower costs to replace and repair our products. cost of service revenue was comprised primarily of personnel costs.
operating expenses year ended december 31,                          change                      % change
2020                                                                                                                                    2019
amount                                                                  % of                        amount                              % of revenue                                                         revenue
(in millions, except percentages)
operating expenses:
research and development                          $341.4                            13    %                       $277.1                            13   %                       $64.3                            23    %
sales and marketing                              1,071.9                            41                             926.9                            43        145.0                                               16
general and administrative                         119.5                             5                             102.1                             5        17.4                                                17
gain on intellectual property matter              (40.2)                           (2)                                 -                             -                          (40.2)                                  *
total operating expenses                        $1,492.6                            58    %                     $1,306.1                            60   %                      $186.5                            14    %
percentages have been rounded for presentation purposes and may differ from unrounded results.
* not meaningful research and development research and development expense increased by $64.3 million, or 23%, in 2020 compared to 2019, primarily due to an increase in personnel-related costs of $49.0 million as a result of increased headcount to support the development of new products and continued enhancements to our existing products. in addition, product development costs, such as third-party testing and prototypes, increased $12.3 million. we currently intend to continue to invest in our research and development organization, and expect research and development expense to increase in absolute dollars in 2021.
sales and marketing sales and marketing expense increased by $145.0 million, or 16%, in 2020 compared to 2019, primarily due to an increase in personnel-related costs of $173.4 million as a result of increases to sales and marketing headcount in order to drive global market revenue increases. this increase was offset by savings related to decreased travel and fewer in-person marketing events as a result of the covid-19 pandemic. we currently intend to continue to make investments in sales and marketing resources, which are critical to support our future growth, and expect sales and marketing expense to increase in absolute dollars in 2021.
general and administrative general and administrative expense increased by $17.4 million, or 17%, in 2020 compared to 2019, primarily due to an increase in personnel-related costs of $9.3 million, an increase in legal-related costs of $2.5 million, an increase in professional services fee of $2.2 million and an increase in the provision for expected credit losses of $2.0 million. we currently expect general and administrative expense to increase in absolute dollars in 2021.
gain on ip matter in january 2020, we entered into an agreement with a competitor in the network security industry, whereby, in february 2020, the competitor party paid us a lump sum of $50.0 million for a mutual covenant-not-to-sue for patent claims. in 2020 we recorded a $40.2 million gain on intellectual property matter in our consolidated statements of income. see note 12 of the notes to consolidated financial statements included in part ii, item 8 of this annual report on form 10-k for additional information regarding the gain on ip matter.
operating income and margin we generated operating income of $531.8 million in 2020, an increase of $180.8 million, or 52%, compared to $351.0 million in 2019. operating income as a percentage of revenue increased to 20% in 2020 compared to 16% in 2019. the increase in operating margin is primarily due to the $40.2 million gain on ip matter, the 1.4 percentage point improvement in gross margin and the 1.6 percentage point decrease in sales and marketing expense as a percentage of revenue.
interest income-net and other expense-net year ended december 31,
2020                       2019                                             change                         % change
(in millions, except percentages)
interest income-net        $17.7                           $42.5                           $(24.8)                           (58)   %
other expense-net          $(7.8)                          $(7.5)                          $(0.3)          4                        %
interest income-net decreased in 2020 as compared to 2019, primarily due to lower interest rates and, to a lesser extent, lower invested balances of cash, cash equivalents and investments. interest income-net varies depending on our average investment balances during the period, types and mix of investments, and market interest rates. the change in other expense-net in 2020 as compared to 2019 was the result of a $4.3 million impairment charge on an investment in a privately held company during 2020 compared to a $3.8 million impairment charge on an investment in a privately held company in the same period last year.
provision for (benefit from) income taxes year ended december 31,               change                       % change
2020                                                    2019
(in millions, except percentages)
provision for income taxes         $53.2                       $54.3                      $(1.1)                       (2)       %
effective tax rate                    10    %   14                       %
our provision for income taxes for 2020 reflects an effective tax rate of 10%, compared to an effective tax rate of 14% for 2019. the provision for income taxes for 2020 was comprised primarily of a $146.8 million tax expense related to u.s. federal and state taxes, other foreign income taxes, foreign withholding taxes and unrecognized tax benefits. the provision was partially offset by a tax benefit of $44.3 million from the fdii deduction, excess tax benefits of $42.0 million from stock-based compensation expense and tax benefits of $7.5 million from federal research and development tax credits.
our provision for income taxes for 2019 reflects an effective tax rate of 14%, compared to an effective tax rate benefit of 32% for 2018. the provision for income taxes for 2019 was comprised primarily of a $90.3 million tax expense related to u.s. federal and state taxes, other foreign income taxes and foreign withholding taxes and a $10.1 million tax expense for an unrecognized tax benefit related to the ninth circuit's opinion in altera corporation and subsidiaries vs. commissioner of internal revenue ("altera"). the provision was partially offset by excess tax benefits of $39.3 million from stock-based compensation expense and tax benefits of $6.8 million from federal research and development tax credits.
unaudited quarterly results of operations the following table sets forth our unaudited quarterly statements of income for the last eight quarters. the quarterly results of operations for the four quarters of 2019 were adjusted for an immaterial error related to the commencement of revenue recognition for certain forticare support service contracts, which resulted in an understatement of revenue. see note 2 of the notes to consolidated financial statements included in part ii, item 8 of this annual report on form 10-k for further detail. additionally, the quarterly results of operations for the first two quarters of 2020 were also adjusted to reflect the correction of the immaterial error related to the commencement of revenue recognition for certain forticare support service contracts, which resulted in an understatement of revenue.
the information for each of these quarters has been prepared on the same basis as the audited annual financial statements included elsewhere in this annual report and, in the opinion of management, includes all adjustments, which includes only normal recurring adjustments, necessary for the fair presentation of the results of operations for these periods. this data should be read in conjunction with our audited consolidated financial statements and related notes included elsewhere in this annual report. these quarterly operating results are not necessarily indicative of our operating results for any future period.
three months ended dec 31, 2020                              sep 30, 2020                                                               jun 30, 2020                                                               mar 31, 2020
as reported                               as reported                    as previously reported                     as corrected                    as previously reported                     as corrected
(in millions, except per share amounts)
consolidated statements of income data:
revenue:
product                                           $288.4                                    $223.8                                 $211.9                              $211.9                                 $192.3                              $192.3
service                                            459.6                                     427.3                                            403.6                     405.7                                            384.6                     385.4
total revenue                                      748.0                                     651.1                                  615.5                               617.6                                  576.9                               577.7
cost of revenue:
product (1)(2)                                     107.4                                      84.3                                             84.4                      84.4                                             76.3                      76.3
service (1)(2)                                      59.6                                      54.9                                             50.7                      50.7                                             52.4                      52.4
total cost of revenue                              167.0                                     139.2                                  135.1                               135.1                                  128.7                               128.7
total gross profit                                 581.0                                     511.9                                  480.4                               482.5                                  448.2                               449.0
operating expenses:
research and development (1)                        89.0                                      90.0                                             82.1                      82.1                                             80.3                      80.3
sales and marketing (1)(2)                         291.4                                     266.7                                            253.8                     253.8                                            260.0                     260.0
general and administrative (1)                      32.4                                      29.4                                             28.9                      28.9                                             28.8                      28.8
gain on intellectual property matter               (1.2)                                     (1.1)                                  (1.1)                               (1.1)                                 (36.8)                              (36.8)
total operating expenses                           411.6                                     385.0                                  363.7                               363.7                                  332.3                               332.3
operating income                                   169.4                                     126.9                                  116.7                               118.8                                  115.9                               116.7
interest income-net                                  2.0                                       2.5                                              4.0                       4.0                                              9.2                       9.2
other income (expense)-net                           0.3                                     (1.0)                                              0.9                       0.9                                  (8.0)                               (8.0)
income before income taxes                         171.7                                     128.4                                  121.6                               123.7                                  117.1                               117.9
provision for income taxes                          25.0                                       5.0                                              9.5                       9.9                                             13.1                      13.3
net income                                        $146.7                                    $123.4                                 $112.1                              $113.8                                 $104.0                              $104.6
net income per share:
basic                                              $0.90                                     $0.76                                  $0.69                               $0.70                                  $0.61                               $0.61
diluted                                            $0.89                                     $0.75                                  $0.68                               $0.69                                  $0.60                               $0.60
three months ended dec 31, 2019                                                                 sept 30, 2019                                                               jun 30, 2019                                                               mar 31, 2019
as previously reported                        as corrected                       as previously reported                     as corrected                    as previously reported                     as corrected                    as previously reported                     as corrected
(in millions, except per share amounts)
consolidated statements of income data:
revenue:
product                                           $238.8                                 $238.8                                    $197.1                              $197.1                                 $189.9                              $189.9                                 $162.7                              $162.7
service                                            375.6                                  379.3                                     350.4                               351.0                                            331.8                     333.9                                  309.9                               310.3
total revenue                                      614.4                                  618.1                                     547.5                               548.1                                  521.7                               523.8                                  472.6                               473.0
cost of revenue:
product (1)(2)                                      92.7                                   92.7                                      79.0                                79.0                                             82.7                      82.7                                   70.2                                70.2
service (1)(2)                                      47.8                                   47.8                                      45.1                                45.1                                             45.6                      45.6                                   42.8                                42.8
total cost of revenue                              140.5                                  140.5                                     124.1                               124.1                                  128.3                               128.3                                  113.0                               113.0
total gross profit                                 473.9                                  477.6                                     423.4                               424.0                                  393.4                               395.5                                  359.6                               360.0
operating expenses:
research and development (1)                        71.2                                   71.2                                      69.9                                69.9                                             67.4                      67.4                                   68.6                                68.6
sales and marketing (1)(2)                         257.1                                  257.1                                     227.4                               227.4                                            226.5                     226.5                                  215.9                               215.9
general and administrative (1)                      27.2                                   27.2                                      26.1                                26.1                                             24.3                      24.3                                   24.5                                24.5
total operating expenses                           355.5                                  355.5                                     323.4                               323.4                                  318.2                               318.2                                  309.0                               309.0
operating income                                   118.4                                  122.1                                     100.0                               100.6                                   75.2                                77.3                                   50.6                                51.0
interest income-net                                  9.9                                    9.9                                      11.4                                11.4                                             11.0                      11.0                                   10.2                                10.2
other expense-net                                  (0.6)                                  (0.6)                                     (6.0)                               (6.0)                                  (0.4)                               (0.4)                                  (0.5)                               (0.5)
income before income taxes                         127.7                                  131.4                                     105.4                               106.0                                   85.8                                87.9                                   60.3                                60.7
provision for income taxes                          12.5                                   13.2                                      25.6                                25.8                                             13.1                      13.7                                    1.5                                 1.6
net income                                        $115.2                                 $118.2                                     $79.8                               $80.2                                  $72.7                               $74.2                                  $58.8                               $59.1
net income per share:
basic                                              $0.67                                  $0.69                                     $0.47                               $0.47                                  $0.42                               $0.43                                  $0.35                               $0.35
diluted                                            $0.66                                  $0.67                                     $0.46                               $0.46                                  $0.42                               $0.42                                  $0.34                               $0.34
(1) includes stock-based compensation as follows:
three months ended dec 31,                sept 30,                 jun 30,                 mar 31,                 dec 31,                sept 30,                 jun 30,                 mar 31,
2020                    2020                    2020                    2020                    2019                    2019                    2019                    2019
(in millions)
cost of product revenue                         $0.4                    $0.4                    $0.4                    $0.4                    $0.3                    $0.4                    $0.4                    $0.4
cost of service revenue                          3.4                     3.3                     3.2                     3.0                     2.9                     2.7                     2.9                     2.8
research and development                        12.0                    12.7                    12.0                    10.9                    10.0                     9.3                    10.0                     9.4
sales and marketing                             27.1                    27.7                    27.9                    25.7                    25.1                    24.9                    26.3                    25.4
general and administrative                       6.0                     5.9                     6.1                     5.3                     5.4                     5.1                     5.4                     5.0
total stock-based compensation expense         $48.9                   $50.0                   $49.6                   $45.3                   $43.7                   $42.4                   $45.0                   $43.0
(2) total amortization included in product costs, service costs, and sales and marketing expense are as follows:
three months ended dec 31,                 sept 30,                jun 30,                 mar 31,                 dec 31,                 sept 30,                jun 30,                 mar 31,
2020                    2020                    2020                    2020                    2019                    2019                    2019                    2019
(in millions)
amortization of intangible assets         $2.8                    $2.8                    $3.7                    $4.0                    $2.8                    $2.2                    $2.9                    $3.0
seasonality, cyclicality and quarterly revenue trends our quarterly results reflect a pattern of increased customer buying at year-end, which has positively impacted billings and product revenue activity in the fourth quarter. in the first quarter, we generally experience lower sequential customer buying, followed by an increase in buying in the second quarter. in 2020, seasonality was impacted by the covid-19 pandemic. although these seasonal factors are common in the technology sector, historical patterns should not be considered a reliable indicator of our future sales activity or performance. on a quarterly basis, we have usually generated the majority of our revenue in the final month of each quarter and a significant amount in the last two weeks of each quarter. we believe this is due to customer buying patterns typical in this industry.
consistent with the seasonality note above, our total quarterly revenue over the past two years has generally increased sequentially each year. product revenue increased year-over-year as compared to 2019, as we have continued product innovation and successfully launched new product models, expanded our solution sales, with focus on sd-wan and work from home solutions and continued our investments in our sales and marketing organizations. due to our growing customer base, we continue to see a relative shift from product revenue to higher-margin, recurring service revenue.
total gross margin has fluctuated on a quarterly basis primarily due to the relative service and product mix as well as the seasonality of cost increases. product gross margin varies based on the types of products sold, their cost profile and the average selling prices of our products. in 2020, product gross margin was impacted by new product introductions and the mix of high-end, mid-range and entry-level products and other fabric appliances as well as increasing software sales. we have been able to improve our direct cost of appliances with newer generations, and our product gross margin continuously benefits from increasing software sales. service gross margin is impacted by revenue growth and our personnel-related costs, third-party repair and contract fulfillment, data center and cloud hosting, supplies and facility-related costs.
liquidity and capital resources as of december 31,
2020                                                                          2019                          2018
(in millions)
cash and cash equivalents                                      $1,061.8                      $1,222.5                      $1,112.4
investments                                                       893.8       987.4                         604.2
total cash, cash equivalents and investments                   $1,955.6                      $2,209.9                      $1,716.6
working capital                                                  $910.9                      $1,313.2                        $975.5
year ended december 31,
2020                                                                          2019                          2018
(in millions)
net cash provided by operating activities                      $1,083.7                        $808.0                        $638.9
net cash used in investing activities                            (72.8)                       (502.3)                       (134.9)
net cash used in financing activities                         (1,171.6)                       (195.6)                       (202.6)
net (decrease) increase in cash and cash equivalents           $(160.7)                        $110.1                        $301.4
liquidity and capital resources is impacted by our operating activities, as well as by our stock repurchases, proceeds from the issuances of common stock under our the amended and restated fortinet, inc. 2009 equity incentive plan (the "2009 plan") and payment of taxes in connection with the net settlement of equity awards, real estate and other capital expenditures and business acquisitions.
in recent years, we have received significant capital resources from our billings to customers and, to some extent, from the exercise of stock options by our employees. additional increases in billings may depend on a number of factors, including demand for our products and services, competition, market or industry changes, macroeconomic events such as the covid-19 pandemic and our ability to execute. we expect proceeds from the exercise of stock options in future years to be impacted by the increased mix of restricted stock units versus stock options granted to our employees and to vary based on our share price.
in february 2020, we received a cash payment of $50.0 million pursuant to a mutual covenant-not-to-sue and release agreement with a competitor in the network security industry.
in july 2020, our board of directors approved a $500.0 million increase in the authorized stock repurchase amount under the repurchase program and extended the term of the repurchase program to february 28, 2022, bringing the aggregate amount authorized to be repurchased to $3.0 billion. in 2020, we repurchased 11.7 million shares of common stock under the repurchase program for an aggregate purchase price of $1.08 billion. as of december 31, 2020, $1.01 billion remained available for future share repurchases under the repurchase program.
construction of a second building at our headquarters campus started in the fourth quarter of 2018 and related spending will continue until project completion. we estimate 2021 spending on the second building of our headquarters campus project to be between $50.0 million and $60.0 million, which was moved from 2020 due to a delay to the project schedule as a result of the covid-19 pandemic. we estimate construction to be completed in the first half of 2021.
as of december 31, 2020, our cash, cash equivalents and investments of $1.96 billion were invested primarily in deposit accounts, money market funds, corporate debt securities, commercial paper, certificates of deposit and term deposits and u.s. government securities. it is our investment policy to invest excess cash in a manner that preserves capital, provides liquidity and generates return without significantly increasing risk. we do not enter into investments for trading or speculative purposes.
the amount of cash, cash equivalents and investments held by our international subsidiaries was $119.8 million and $109.3 million as of december 31, 2020 and as of december 31, 2019, respectively.
we believe that our existing cash and cash equivalents will be sufficient to meet our anticipated cash needs for at least the next 12 months. our future capital requirements will depend on many factors, including our growth rate, the timing and amount of our share repurchases, the expansion of sales and marketing activities, the introduction of new and enhanced products and services offerings, the continuing market acceptance of our products, the timing and extent of spending to support development efforts, our investments in purchasing or leasing real estate and macroeconomic impacts such as the covid-19 pandemic. historically, we have required capital principally to fund our working capital needs, share repurchases, capital expenditures and acquisition activities. in the event that additional financing is required from outside sources, we may not be able to raise it on terms acceptable to us or at all.
operating activities cash generated by operating activities is our primary source of liquidity. it is primarily comprised of net income, as adjusted for non-cash items and changes in operating assets and liabilities. non-cash adjustments consist primarily of stock-based compensation, amortization of deferred contract costs and depreciation and amortization. changes in operating assets and liabilities consist primarily of changes in deferred revenue, deferred contract costs and accounts receivable.
our operating activities during 2020 provided $1.08 billion in cash as a result of the continued growth of our business and our ability to successfully manage our working capital. changes in operating assets and liabilities primarily resulted from an increase in sales of our fortiguard and other security services subscription and forticare technical support services to new and existing customers, as reflected by an increase in our deferred revenue, and proceeds from the mutual covenant-not-to-sue and release agreement. our total deferred revenue balance grew $496.2 million, or 24%, during 2020.
investing activities the changes in cash flows from investing activities primarily relate to timing of purchases, maturities and sales of investments and purchases of property and equipment. historically, in making a lease versus ownership decision related to our larger facilities, we have considered various factors including financial metrics and the impact on our engineers and other employees. in certain cases, we have elected to own the facility if we believed that ownership rather than leasing is more in line with our long-term strategy. we may make similar decisions in the future. we may also make cash payments in connection with future business combinations.
during 2020, cash used in investing activities was primarily driven by $125.9 million spent on purchases of property and equipment, a large portion of which relates to our headquarters building construction, and $40.2 million used for the opaq and panopta acquisitions, net of cash acquired, and partially offset by $92.0 million provided by sales and maturities of investments, net of purchases of investments.
financing activities the changes in cash flows from financing activities primarily relate to repurchase and retirement of common stock and taxes paid related to net share settlement of equity awards, net of proceeds from the issuance of common stock under the 2009 plan.
during 2020, cash used in financing activities was $1.17 billion, primarily due to $1.08 billion used to repurchase shares of our common stock, $86.1 million used to pay tax withholding, net of proceeds from the issuance of common stock, and $4.1 million used to pay debt assumed in connection with the opaq acquisition.
contractual obligations and commitments the following summarizes our inventory purchase commitments as of december 31, 2020:
payments due by period total                           less than 1 year                       1 - 3 years                      3 - 5 years                      more than 5 years
(in millions)
inventory purchase commitments (1)        $259.4                          $259.4                                 $-                               $-                               $-
(1) consists of minimum purchase commitments with independent contract manufacturers.
in addition to commitments with contract manufacturers, we have open purchase orders and contractual obligations in the ordinary course of business for which we have not received goods or services. as of december 31, 2020, we had $28.9 million in other contractual commitments having a remaining term in excess of one year that may not be cancelable.
as of december 31, 2020, we had $90.3 million of long-term income tax liabilities, including interest, related to uncertain tax positions. because of the high degree of uncertainty regarding the settlement of these liabilities, we are unable to estimate the years in which future cash outflows may occur.
off-balance sheet arrangements during 2020, 2019 and 2018, we did not have any relationships with unconsolidated organizations or financial partnerships, such as structured finance or special purpose entities that would have been established for the purpose of facilitating off-balance sheet arrangements or other contractually narrow or limited purposes.
recent accounting pronouncements see note 1 of the notes to our consolidated financial statements in part ii, item 8 of this annual report on form 10-k for a full description of recently adopted accounting pronouncements.
